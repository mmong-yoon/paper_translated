"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["4495"],{78962:function(e,t,n){n.d(t,{A:()=>o});let o={verticalMenuLabel:"verticalMenuLabel-vDULBF"}},50587:function(){},59167:function(e,t,n){n.d(t,{h:()=>u});var o=n(16291);function r(e){var t;let n=[e.is_primary,(null==(t=e.publication)?void 0:t.author_id)===e.user_id,"admin"===e.role,"contributor"===e.role].map(e=>e?"0":"1").join("");return"".concat(n,"-").concat((0,o.A)(e.created_at).valueOf())}function u(e){return e.slice(0).sort((e,t)=>r(e)>r(t)?1:-1)}},10591:function(e,t,n){n.d(t,{N_:()=>C,Si:()=>I,TH:()=>R,U4:()=>E,WK:()=>N,XU:()=>B,ce:()=>v,eH:()=>k,ju:()=>x,mh:()=>U,nd:()=>T,pv:()=>L,yj:()=>w,yt:()=>D});var o=n(79785),r=n(86500),u=n(98111),c=n(4016),a=n(39318),s=n(49807),i=n(82776),l=n(57324),d=n(33333),f=n(4518);function p(){let e=(0,o._)(["Start writing today. Use the button below to create a Substack of your own"]);return p=function(){return e},e}function m(){let e=(0,o._)(["Share ",""]);return m=function(){return e},e}function h(){let e=(0,o._)(["Get ","% off a group subscription"]);return h=function(){return e},e}function b(){let e=(0,o._)(["Get a group subscription"]);return b=function(){return e},e}function _(){let e=(0,o._)(["Give a gift subscription"]);return _=function(){return e},e}function g(){let e=(0,o._)(["","! Subscribe for free to receive new posts and support my work."]);return g=function(){return e},e}function y(){let e=(0,o._)(["",". To receive new posts and support my work, consider becoming a free or paid subscriber."]);return y=function(){return e},e}function S(){let e=(0,o._)(["","! This post is public so feel free to share it."]);return S=function(){return e},e}let L=e=>(t,n)=>{let{iString:o}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,f.c)(t,t.schema.nodes.button))return!1;let r={url:"".concat(u.T.CHECKOUT_URL,"&donate=true"),text:o("Donate Subscriptions")};return n&&n((0,d.DL)(t,t.schema.nodes.button.create(r))),!0},T=e=>(t,n)=>{let{iString:o}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,f.c)(t,t.schema.nodes.button))return!1;let r={url:"".concat(u.T.LEADERBOARD_URL,"&utm_source=").concat(l.VU.post),text:o("Refer a friend")};return n&&n((0,d.DL)(t,t.schema.nodes.button.create(r))),!0},C=e=>{let{writerReferralCode:t,publication:n,postId:o}=e;return(e,r)=>{let{iString:u,iTemplate:c}=I18N.i({pub:n});if(!e.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!e.schema.nodes.captionedWriterReferralButton)return console.error("captionedWriterReferralButton node type not found in schema"),!1;if(!e.schema.nodes.ctaCaption)return console.error("ctaCaption node type not found in schema"),!1;if(!(0,f.c)(e,e.schema.nodes.button))return!1;let s=c(p()),i={url:"".concat((0,a.gWk)(t||""),"?utm_source=").concat(l.VU.substack,"&utm_context=").concat(l.rw.post,"&utm_content=").concat(o,"&utm_campaign=").concat(l._9.writerReferralButton),text:u("Start a Substack")},m=e.schema.nodes.captionedWriterReferralButton.create(i,e.schema.nodes.ctaCaption.create(null,[e.schema.text(s)]));return r&&r((0,d.DL)(e,m)),!0}},U=e=>(t,n)=>{let{iString:o}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,f.c)(t,t.schema.nodes.button))return!1;let r={url:u.T.HALF_MAGIC_COMMENTS_URL,text:o("Leave a comment")};return n&&n((0,d.DL)(t,t.schema.nodes.button.create(r))),!0},v=(e,t,n)=>(o,u)=>{if((0,r.u4)(r.qY.READER_SURVEY_LINKED_IN_POST,{editorVersion:"1",surveyId:t.id}),!o.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,f.c)(o,o.schema.nodes.button))return!1;let c={url:"".concat((0,s.gAK)(e,t.id)),text:n};return u&&u((0,d.DL)(o,o.schema.nodes.button.create(c))),!0},R=e=>(t,n)=>{let{iString:o}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,f.c)(t,t.schema.nodes.button))return!1;let r={url:u.T.SHARE_URL,text:o("Share")};return n&&n((0,d.DL)(t,t.schema.nodes.button.create(r))),!0},w=e=>(t,n)=>{let{iTemplate:o}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,f.c)(t,t.schema.nodes.button))return!1;let r={url:u.T.SHARE_PUB_URL,text:o(m(),e.name)};return n&&n((0,d.DL)(t,t.schema.nodes.button.create(r))),!0},B=e=>{let{couponPub:t,scrollParent:n,parentClass:o,get_coupons:r,insert_coupon:u,SelectField:c,openPrompt:s,closePrompt:i,getNetworkErrorMessage:l}=e;return(e,d,p)=>{let{iString:m}=I18N.i({pub:t});if(!e.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,f.c)(e,e.schema.nodes.button))return!1;let h={parentClass:o,root:n?document.querySelector(".".concat(n)):p.dom.parentNode,scrollParent:n,offsetTop:10},b=Object.assign({title:m("Loading..."),no_buttons:!0,language:t.language},h);return s(b),r().then(n=>{i(b);let o=n.map(e=>{var t;return{label:null!=(t=e.name)?t:"",value:e}}).concat([{label:m("Create new offer"),value:{create_new:!0}}]),r={coupon:new c({label:m("Select offer..."),required:!0,options:o,onChange:e=>{e&&"create_new"in e&&e.create_new&&(i(l),window.open("".concat((0,a.$_T)(t),"/publish/offers"),"_blank"))}})},l=Object.assign({title:m("Special Offer"),fields:r,language:null==t?void 0:t.language,onSubmit:t=>{let{coupon:n}=t;u({coupon:n,state:e,dispatch:p.dispatch,schema:e.schema})},onClose:()=>{p.focus()}},h);s(l)}).catch(e=>{i(b),alert(l(e))}),!1}},x=e=>{let{scrollParent:t,parentClass:n,TextField:o,openPrompt:r,publication:a}=e;return(e,s,i)=>{let{iString:l}=I18N.i({pub:a});if(!e.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,f.c)(e,e.schema.nodes.button))return!1;let p={parentClass:n,title:l("Create a button"),root:t?document.querySelector(".".concat(t)):i.dom.parentNode,scrollParent:t,offsetTop:10,language:null==a?void 0:a.language,fields:{text:new o({label:l("Enter text..."),required:!0,clean:e=>(e||"").trim(),validate:e=>{if(e.length>40)return l("Too long")}}),href:new o({label:l("Enter URL..."),required:!0,clean:e=>(e||"").trim(),validate:e=>{if(!/^%%.*%%$/.test(e)){try{let t=new URL(e);if(["http:","https:","mailto:"].includes(t.protocol))return}catch(e){}return l("Invalid URL")}}})}};return p.onSubmit=t=>{let n=t.href;if((0,c.lu)({pub:a})){let[e,t]=n.split("#"),o=e.includes("?")?"&":"?",r=["utm_source=custom_button","utm_medium=".concat(u.T.SEND_MEDIUM),"utm_campaign=".concat(u.T.POST_ID)].join("&");n="".concat(e).concat(o).concat(r).concat(t?"#".concat(t):"")}let o={url:n,text:t.text};if(!e.schema.nodes.button)return console.error("Button node type not found in schema"),!1;s&&i.dispatch((0,d.DL)(e,e.schema.nodes.button.create(o)))},p.onClose=()=>{i.focus()},r(p),!0}},D=e=>{let{publication:t}=e;return(e,n)=>{let{iTemplate:o}=I18N.i({pub:t});if(!e.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,f.c)(e,e.schema.nodes.button))return!1;let r=t.default_group_coupon,c={url:"".concat(u.T.CHECKOUT_URL,"group=true").concat(r?"&coupon=".concat(r):""),text:(0,i.getSubscriptionSentenceWithCustomWords)(t,()=>{var e;return r&&t.default_group_coupon_percent_off?o(h(),null!=(e=t.default_group_coupon_percent_off.split(".")[0])?e:""):o(b())},e=>r&&t.default_group_coupon_percent_off?"Get ".concat(t.default_group_coupon_percent_off.split(".")[0],"% off a group ").concat(e.subscription):"Get a group ".concat(e.subscription))};return n&&n((0,d.DL)(e,e.schema.nodes.button.create(c))),!0}},k=e=>(t,n)=>{let{iTemplate:o}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,f.c)(t,t.schema.nodes.button))return!1;let r={url:"".concat(u.T.CHECKOUT_URL,"&gift=true"),text:(0,i.getSubscriptionSentenceWithCustomWords)(e,()=>o(_()),e=>"Give a gift ".concat(e.subscription))};return n&&n((0,d.DL)(t,t.schema.nodes.button.create(r))),!0},I=e=>(t,n)=>{if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!(0,f.c)(t,t.schema.nodes.button))return!1;let o={url:u.T.CHECKOUT_URL,text:(0,i.getSubscribeText)(e,{now:!0}),language:e.language};return n&&n((0,d.DL)(t,t.schema.nodes.button.create(o))),!0},N=e=>(t,n)=>{let{iTemplate:o}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!t.schema.nodes.subscribeWidget)return console.error("subscribeWidget node type not found in schema"),!1;if(!t.schema.nodes.ctaCaption)return console.error("ctaCaption node type not found in schema"),!1;if(!(0,f.c)(t,t.schema.nodes.button))return!1;let r="enabled"!==e.payments_state?o(g(),e.author_name===e.name?"Thanks for reading":"Thanks for reading ".concat(e.name)):o(y(),e.author_name===e.name?"This Substack is reader-supported":"".concat(e.name," is a reader-supported publication")),c={url:u.T.CHECKOUT_URL,text:(0,i.getSubscribeText)(e),language:e.language},a=t.schema.nodes.subscribeWidget.create(c,[t.schema.nodes.ctaCaption.create(null,[t.schema.text(r)])]);return n&&n((0,d.DL)(t,a)),!0},E=e=>(t,n)=>{let{iString:o,iTemplate:r}=I18N.i({pub:e});if(!t.schema.nodes.button)return console.error("Button node type not found in schema"),!1;if(!t.schema.nodes.captionedShareButton)return console.error("captionedShareButton node type not found in schema"),!1;if(!t.schema.nodes.ctaCaption)return console.error("ctaCaption node type not found in schema"),!1;if(!(0,f.c)(t,t.schema.nodes.button))return!1;let c=r(S(),e.author_name===e.name?"Thanks for reading":"Thanks for reading ".concat(e.name)),a={url:u.T.SHARE_URL,text:o("Share")},s=t.schema.nodes.captionedShareButton.create(a,t.schema.nodes.ctaCaption.create(null,[t.schema.text(c)]));return n&&n((0,d.DL)(t,s)),!0}},10933:function(e,t,n){n.d(t,{kI:()=>u});var o=n(33333);let r=e=>!(0,o.cy)(e.doc.toJSON(),e=>"paywall"===e.type),u=e=>(t,n)=>{if(!r(t))return!1;let{schema:o,tr:u}=t,a=o.nodes.paywall.create();return 1===u.selection.anchor?c(e)(t,n):(u.insert(u.selection.anchor,a),n&&(n(u),e()),!0)},c=e=>(t,n)=>{if(!r(t))return!1;let{schema:o,tr:u}=t,c=o.nodes.paywall.create(),a=0,s=0;for(;a<10&&s<3;){let e=t.doc.resolve(a).nodeAfter;if(!e)break;a+=e.nodeSize,s++}return u.insert(a,c),n&&(n(u),e()),!0}}}]);