"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["4581"],{23725:function(e,i,t){t.d(i,{A:()=>s});var a=t(69277),o=t(70408),d=t(10201),l=t(97731);let s=e=>(0,d.FD)(l.A,(0,o._)((0,a._)({},e),{name:"SimpleCheckmarkIcon",svgParams:{height:100,width:100},children:[(0,d.Y)("path",{d:"m40.9 70c-.5 0-1-.2-1.4-.6-.8-.8-.8-2 0-2.8l36.8-36.8c.8-.8 2-.8 2.8 0s.8 2 0 2.8l-36.8 36.8c-.4.4-.9.6-1.4.6z"}),(0,d.Y)("path",{d:"m40.9 70c-.5 0-1-.2-1.4-.6l-16.5-16.5c-.8-.8-.8-2 0-2.8s2-.8 2.8 0l16.5 16.5c.8.8.8 2 0 2.8-.4.4-.9.6-1.4.6z"})]}))},95032:function(e,i,t){t.d(i,{A:()=>R,V:()=>K});var a=t(99851),o=t(69277),d=t(70408),l=t(10201),s=t(32485),r=t.n(s),n=t(50802),p=t(3213),c=t(94796),u=t(32708),h=t(15734),v=t.n(h),m=t(41873),U=t(84605),y=t(85936),P=t(29797),w=t(22431),g=t(291),f=t(32465),_=t(41696),b=t(51091),Y=t(22714),F=t(5461),E=t(60005),M=t(86500),S=t(68349),C=t(12387),T=t(35369),x=t(76977),A=t(88774),D=t(63136),k=t(65120),V=t(13348),I=t(82776),O=t(22347);class R extends g.Ay{componentDidUpdate(e,i){var t,a,o;(null==(t=this.state.mediaUpload)?void 0:t.state)==="transcoded"&&(null==(a=i.mediaUpload)?void 0:a.state)!==(null==(o=this.state.mediaUpload)?void 0:o.state)&&this.activateThumbnailSetter(),this.props.initialFile!==e.initialFile&&this.setState({file:this.props.initialFile}),super.componentDidUpdate(e,i)}render(){var e,i,t;let{pub:a,postId:o,setPostId:d,onUploadStarted:s,onUploadCanceled:h,videoFeature:v,mediaUpload:U,onProgress:y,onOpenDrawer:Y,setVideoRecorderOpen:F,language:M,audioExtractPreviewMediaUpload:S,onOpenVideoSettings:C,postMediaComposition:x}=this.props,{settingThumbnail:R,settingPreview:z,file:K}=this.state,N=(null==U?void 0:U.media_type)==="video"&&"embed"!==this.props.videoFeature,q=!N&&z,B=R||z,{iString:H}=this.i18n,W=(null==U?void 0:U.state)==="transcoded",j="podcastDrawer"===v,G=!x||"completed"===x.workflow_state,Q=U&&["cancelled","error"].includes(U.state),X=U&&"uploaded"===U.state,J=!!(null==U?void 0:U.id);return(0,l.Y)("div",{className:r()("video-editor",{[O.A.videoEditorEmbed]:["embed","podcast","podcastDrawer"].includes(v)}),children:W&&G?j?(0,l.FD)(l.FK,{children:[(0,l.Y)("input",{ref:this.assignInput,type:"file",accept:g.vj,onChange:e=>{this.removeUpload({skipConfirm:!0});let i=e.target,t=i.files?i.files[0]:null;this.setState({file:t})},style:{display:"none"}}),(0,l.Y)(k.B,{padding:16,border:"detail",radius:"sm",marginTop:16,children:(0,l.Y)(k.z,{icon:(0,l.Y)(n.A,{}),title:H("Uploaded video"),subtitle:U.primary_file_size?(0,I.numberToHumanFileSize)(U.primary_file_size):"",action:(0,l.FD)(A.W1,{trigger:(0,l.Y)(T.K0,{size:"sm",priority:"quaternary",rounded:!1,children:(0,l.Y)(p.A,{})}),children:[(0,l.Y)(A.H9,{isFirst:!0,children:(0,l.Y)(A.Dr,{leading:(0,l.Y)(c.A,{}),onClick:()=>{var e;return null==(e=this.input)?void 0:e.click()},children:H("Replace")})}),(0,l.Y)(A.H9,{children:(0,l.Y)(A.Dr,{leading:(0,l.Y)(u.A,{}),priority:"destructive",onClick:()=>this.removeUpload(),children:H("Remove")})})]})})})]}):(0,l.FD)("div",{className:"video-editor-player",children:[(0,l.Y)(m.A,{ref:this.assignVideoPlayer,mediaUpload:U,pub:a,noPreview:B,noControls:q,noKeyboardShortcuts:q,showPreviewWhenPaused:!0,renderPlayButton:()=>(0,l.Y)(V.ro,{isPlaying:!1,size:72}),surface:"editor",contentType:"post",entityType:"post",entityKey:null!=o?o:"unknown",stopPropagation:!0}),(0,l.Y)(P.A,{videoPlayerRef:null==(e=this.videoPlayer)?void 0:e.player,videoUpload:U,active:R,onCancel:()=>this.setState({settingThumbnail:!1}),onUpdate:e=>{this.onMediaUploadUpdated(e),this.setState({settingThumbnail:!1})}}),(0,l.Y)(w.h,{videoPlayerRef:null==(i=this.videoPlayer)?void 0:i.player,videoUpload:U,active:z,onCancel:()=>this.setState({settingPreview:!1}),onUpdate:e=>{this.setState({settingPreview:!1}),this.onMediaUploadUpdated(e)},audioPreviewMediaUpload:S,onAudioExtractPreviewMediaUpload:this.onAudioExtractPreviewMediaUpload}),"embed"!==this.props.videoFeature&&(0,l.Y)(E.A,{videoPlayer:this.videoPlayer,pub:a,postId:null!=o?o:null,mediaUpload:U,audioExtractMediaUpload:null!=(t=this.state.audioExtractMediaUpload)?t:null,onOpenThumbnail:()=>this.setState({settingThumbnail:!0}),onThumbnailUpdated:this.onMediaUploadUpdated,onOpenSettings:function(){let{tab:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null==Y||Y({mediaType:"video",initialTab:e})},onOpenFreePreview:()=>this.setState({settingPreview:!0}),onRemoveFreePreview:()=>this.removeFreePreview(),onRemoveMedia:()=>this.removeUpload(),active:!B,onOpenVideoSettings:C}),B&&N&&(0,l.Y)("div",{className:O.A.topLabels,children:(0,l.Y)(D.EY.B4,{className:O.A.topLabel,children:R?H("Edit thumbnail"):z?H("Create free preview"):""})})]}):Q?(0,l.Y)(f.a,{onClick:()=>this.removeUpload()}):X?(0,l.Y)(b.Q,{onCancel:()=>this.removeUpload()}):J?(0,l.Y)(_.V,{}):(0,l.Y)(L,{initialFile:K,videoFeature:v,mediaType:"video",postId:o,onUpload:e=>{this.onMediaUpload({mediaUpload:e.mediaUpload}),this.onAudioExtractMediaUpload({mediaUpload:e.audioExtractMediaUpload})},setPostId:d,onProgress:y,setVideoRecorderOpen:F,onUploadStarted:s,onUploadCanceled:h,language:M,maxVideoDurationSeconds:null,onVideoTooLong:null})})}constructor(e,i){var t,d;super(e,i),(0,a._)(this,"videoPlayer",null),(0,a._)(this,"input",null),(0,a._)(this,"assignVideoPlayer",e=>{this.videoPlayer=e}),(0,a._)(this,"assignInput",e=>{this.input=e}),(0,a._)(this,"loadVideoFrame",async e=>{var i,t;if(!(null==(i=this.videoPlayer)?void 0:i.player))return void console.error("loadVideoFrame called, but videoPlayer not set");if(this.videoPlayer.player.readyState<2){let e,i=new Promise(i=>e=i);this.videoPlayer.player.addEventListener("canplay",e),this.videoPlayer.player.load(),await Promise.race([i,new Promise(e=>setTimeout(e,1e3))]),null==(t=this.videoPlayer)||t.player.removeEventListener("canplay",e)}this.videoPlayer&&(this.videoPlayer.player.currentTime=e),await new Promise(e=>setTimeout(e,100))}),(0,a._)(this,"activateThumbnailSetter",async()=>{var e,i;if(null==(e=this.optionsDropdown)||e.close(),!this.state.settingThumbnail){if(!this.state.mediaUpload)return void console.error("activateThumbnailSetter, mediaUpload is not set ");(null==(i=this.videoPlayer)?void 0:i.player)&&(await this.loadVideoFrame((this.state.mediaUpload.thumbnail_id-1)*5),this.setState({settingThumbnail:!0,settingPreview:!1}))}}),(0,a._)(this,"activatePreviewSetter",async()=>{var e,i;if((null==(e=this.optionsDropdown)||e.close(),!this.state.settingPreview)&&(null==(i=this.videoPlayer)?void 0:i.player)){if(!this.state.mediaUpload)return void console.error("activatePreviewSetter, mediaUpload is not set");await this.loadVideoFrame(this.state.mediaUpload.preview_start||0),this.setState({settingPreview:!0,settingThumbnail:!1})}}),(0,a._)(this,"removeFreePreview",async()=>{var e,i;let{iString:t}=this.i18n;if(!confirm(t("Remove free preview. Are you sure?")))return;if(!this.state.mediaUpload)return void console.error("removeFreePreview called, mediaUpload not set");let a=(0,o._)({},this.state.audioExtractPreviewMediaUpload),{preview_start:d,preview_duration:s}=this.state.mediaUpload;null==(e=this.optionsDropdown)||e.close(),this.setState({settingPreview:!1}),this.onMediaUploadUpdated({preview_start:null,preview_duration:null}),(null==(i=this.state.audioExtractPreviewMediaUpload)?void 0:i.src_media_upload_id)===this.state.mediaUpload.id&&this.onAudioExtractPreviewMediaUpload({mediaUpload:null});try{await v().delete("/api/v1/video/upload/".concat(this.state.mediaUpload.id,"/preview")),(0,F.O)((0,l.Y)(l.FK,{children:t("Free preview removed")}))}catch(e){this.onMediaUploadUpdated({preview_start:d,preview_duration:s}),this.onAudioExtractMediaUpload({mediaUpload:this.state.audioExtractMediaUpload}),this.onAudioExtractPreviewMediaUpload({mediaUpload:a}),alert((0,S.uX)(e))}}),this.state={settingThumbnail:!1,settingPreview:!1,mediaUpload:null!=(t=this.props.mediaUpload)?t:null,mediaUploadId:null!=(d=this.props.mediaUploadId)?d:null,audioExtractMediaUploadId:e.audioExtractMediaUploadId,audioExtractMediaUpload:e.audioExtractMediaUpload||null,audioExtractPreviewMediaUploadId:e.audioExtractPreviewMediaUploadId,audioExtractPreviewMediaUpload:e.audioExtractPreviewMediaUpload||null,estimatedTimeLeftAt:null,timeLeft:0,percentComplete:1,file:this.props.initialFile}}}class L extends g.v1{trackUploadClicked(){(0,M.u4)(M.qY.UPLOAD_VIDEO_CLICKED)}render(){let{props:e,state:i}=this,{iString:t}=this.i18n,{hideVideoInfoPanel:a}=i,o=this.state.existingEtags.length>0&&!a&&i.uploading;return(0,l.FD)(x.VP,{gap:12,children:[o&&(0,l.Y)(z,{onDismiss:()=>this.setState({hideVideoInfoPanel:!0})}),i.uploading?(0,l.Y)(y.h,{percentComplete:i.percentComplete,onCancel:()=>{if(confirm(t("Are you sure you want to cancel the upload?"))){var e,i;this.cancelUpload(),null==(e=(i=this.props).onUploadCanceled)||e.call(i)}}}):(0,l.Y)(Y.k,{accepts:this.props.accepts||this.accepts,onUploadClicked:()=>this.onUploadClicked(),onFileSelected:e=>this.onFileSelected(e),onVideoRecorded:e=>{let i=new File([e],"web_recording_".concat(Date.now(),".webm"),{type:e.type});this.uploadToS3(i)},videoFeature:e.videoFeature,setVideoRecorderOpen:e.setVideoRecorderOpen})]})}constructor(e,i){super(e,i),(0,a._)(this,"input",null),(0,a._)(this,"assignInput",e=>{this.input=e}),this.state=(0,d._)((0,o._)({},this.state),{hideVideoInfoPanel:!1,videoRecorderModalOpen:!1})}}function z(e){let{onDismiss:i}=e,{iString:t}=(0,U.GO)();return(0,l.Y)(C.F,{title:t("Resuming upload..."),priority:"secondary",theme:"warn",description:t("This video was partially uploaded before. We saved your progress and will now resume."),onDismiss:i})}class K extends g.v1{trackUploadClicked(){(0,M.u4)(M.qY.UPLOAD_VIDEO_CLICKED,{source:"notes"})}render(){return null}constructor(e,i){super(e,i),this.state=(0,d._)((0,o._)({},this.state),{hideVideoInfoPanel:!1})}}}}]);