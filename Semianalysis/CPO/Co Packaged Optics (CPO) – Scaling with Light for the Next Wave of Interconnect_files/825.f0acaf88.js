"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["825"],{16044:function(e,t,n){n.d(t,{A:()=>r});let r={blockContainer:"blockContainer-sGUymL",blockTitleContainer:"blockTitleContainer-_ayaxc",blockTitle:"blockTitle-p5J1JM",blockSubTitle:"blockSubTitle-b49Pjc",inlineContainer:"inlineContainer-pdOZS_",inlineText:"inlineText-mmZJjI"}},10361:function(e,t,n){n.d(t,{OT:()=>o}),n(34921);let r="recentUserQ",l="recentPubQ",o=()=>{"undefined"!=typeof localStorage&&(localStorage.getItem(r)&&localStorage.setItem(r,"[]"),localStorage.getItem(l)&&localStorage.setItem(l,"[]"),localStorage.removeItem("importsReviewPageSize"),localStorage.removeItem("importsReviewColumns"))}},38692:function(e,t,n){n.d(t,{_:()=>g});var r=n(10201),l=n(31583),o=n(31386),i=n(32485),a=n.n(i);n(38221);var s=n(98188),c=n(17402);n(84605);var u=n(56909);n(86500);var d=n(68349);n(35369),n(97515);var p=n(76977);n(16993);var f=n(63136);n(11587);var m=n(90292),h=n(7777);let g=e=>{let{node:t,id:n}=e,[i,g]=(0,c.useState)(t.attrs.persistentExpression);return(0,c.useEffect)(()=>{g(t.attrs.persistentExpression)},[t]),(0,c.useEffect)(()=>{let e=e=>{let{detail:n}=e;n.node.attrs.id===t.attrs.id&&g(n.persistentExpression)};return(0,u.o)().addEventListener("close",e),()=>{(0,u.o)().removeEventListener("close",e)}},[]),(0,r.Y)(l.VR,{"data-drag-handle":"",children:(0,r.Y)(m.q,{children:(0,r.Y)("div",{className:"latex-block",id:n,children:(0,r.Y)(p.I1,{className:a()(h.A.latexWrapper,t.attrs.persistentExpression||(0,d.rr)()?h.A.emptyStateWrapper:null),radius:"md","data-attrs":JSON.stringify({persistentExpression:i,id:t.attrs.id}),onClick:()=>{i!==t.attrs.persistentExpression&&g(t.attrs.persistentExpression),(0,u.o)().dispatchEvent(new CustomEvent("open",{detail:{persistentExpression:t.attrs.persistentExpression,node:t}}))},children:(0,r.FD)(p.Ye,{paddingY:8,paddingX:16,flex:"grow",justifyContent:"center",alignItems:"center",children:[i||t.attrs.persistentExpression?(0,r.Y)(p.I1,{alignItems:"center",justifyContent:"center",children:(0,r.Y)(o.A,{typesettingOptions:{fn:"tex2chtml",options:void 0},text:"".concat(i||t.attrs.persistentExpression),renderMode:"pre",inline:!1,dynamic:!0})}):(0,r.Y)(p.I1,{alignSelf:"center",children:(0,r.Y)(f.EY.Meta,{fontStyle:"italic",translated:!0,color:"secondary",children:"Edit & enter LaTeX expressions here"})}),(0,r.Y)(p.I1,{children:(0,r.Y)("button",{className:h.A.latexEdit,children:(0,r.Y)(s.A,{width:20,height:20})})})]})})})})})}},9472:function(e,t,n){n.d(t,{g:()=>l});var r=n(10201);let l=e=>(0,r.Y)("div",{className:"file-embed-wrapper-editor",children:(0,r.Y)("div",{className:"file-embed-aligner",children:(0,r.Y)("div",{className:"file-embed-container placeholder",children:(0,r.Y)(o,{})})})}),o=()=>(0,r.FD)("div",{className:"embed-loader-container",children:[(0,r.Y)("div",{className:"embed-loader"}),(0,r.Y)("div",{className:"embed-loader-text",children:"Loading..."})]})},90827:function(e,t,n){n.d(t,{P:()=>u,X:()=>c});var r=n(10201),l=n(17402),o=n(35369),i=n(76977),a=n(63136),s=n(78962);let c=(0,l.forwardRef)((e,t)=>{let{onClick:n,children:l,disabled:i=!1,size:a="md"}=e;return(0,r.Y)(o.mZ,{ref:t,rounded:!0,onClick:n,disabled:i,size:a,children:l})}),u=e=>{let{label:t,children:n}=e,[o,c]=(0,l.useState)(!1);return(0,r.FD)(i.Ye,{gap:8,justifyContent:"center",alignItems:"center",children:[t&&(0,r.Y)(i.Ye,{bg:"glass-inverted-medium",justifyContent:"center",alignItems:"center",radius:"sm",paddingY:6,paddingX:8,className:s.A.verticalMenuLabel,style:{opacity:+!!o},children:(0,r.Y)(a.EY.B4,{color:"white",children:t})}),(0,r.Y)("div",{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:n})]})}},37575:function(e,t,n){n.d(t,{H2:()=>M,_R:()=>O});var r=n(69277),l=n(86500);n(68349);var o=n(98111),i=n(82776),a=n(38474),s=n(26116),c=n(39729),u=n(42985),d=n(79431),p=n(45595),f=n(70679),m=n(97966),h=n(70084),g=n(37859),v=n(31611);n(86508);var y=n(17768),b=n(82979),k=n(58097),w=n(30131),x=n(41298),_=n(41758),E=n(75594),A=n(84262),C=n(14304),S=n(13625);n(33333);var T=n(39248),D=n(60147);let N=[[v.NT,v.h$],[w.FR,w.yJ],[S.hq,S.GW],[y.Ys,y.VM],[D.NO,D.Sw],[T.ou,T.zd],[A.mc,A.Xs],[p.RD,p.oM],[d.Bp,d.so],[u.XB,u.w1],[E.AF,E.d1],[s.ez,s.lQ],[b.Rj,b.gE],[g.SU,g.Z7],[m.iO,m.Xs],[h.oI,h.t2],[a.q_,a.TM],[k.Hh,k.Wc],[f.t7,f.eZ],[x.sF,x.DI],[function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=t[0];return r?(0,_.J7)(r):null},_.i1],[function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=t[0];return r?(0,C.S$)(r):null},C.z7],[function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=t[0];return r?(0,c.li)(r):null},c.Sy],[e=>e===o.T.FIRST_NOTE_EMBED,u.x7]],O=(e,t,n)=>{if(t.nodes.augmentation_placeholder)for(let[l]of N){let o=l(e,(0,r._)({customSchema:t},n));if(o){let e=t.nodes.augmentation_placeholder.create({request_id:(0,i.randomString)(),url:o});return[o,e]}}return[null,null]},M=async(e,t,n,o)=>{let i,a,{request_id:s,url:c}=e.attrs;try{for(let[t,a]of N)if(t(e.attrs.url,(0,r._)({customSchema:n},o))&&((0,l.u4)(l.qY.EMBED_URL_ATTEMPTED,{url:c,source:"paste"}),i=await a(c,{customSchema:n}),(0,l.u4)(l.qY.EMBED_URL_SUCCEEDED,{url:c,source:"paste"}),i))break}catch(t){(0,l.u4)(l.qY.EMBED_URL_FAILED,{url:c,source:"paste"}),console.error("Failed to process augmentation placeholder:",e.attrs,t),400<=t.status&&t.status<600&&(a=t)}if(a){let r=(0,S.hq)(e.attrs.url);if(setTimeout(()=>{L(s,t,n,(e,t,l)=>{r&&n.marks.link&&e.replaceRangeWith(t,t+l.nodeSize,n.text(l.attrs.url,[n.marks.link.create({title:l.attrs.url,href:l.attrs.url})])),e.delete(t,t+l.nodeSize)})},0),!r)throw a}else i?setTimeout(()=>{L(s,t,n,(e,t,n)=>{i&&e.setNodeMarkup(t,i.type,i.attrs,n.marks)})},0):setTimeout(()=>{L(s,t,n,(e,t,r)=>{e.replaceRangeWith(t,t+r.nodeSize,n.text(r.attrs.url))})},0)},L=(e,t,n,r)=>{let l=!1,o=t.state.tr;return t.state.doc.descendants((t,i)=>{t.type===n.nodes.augmentation_placeholder&&t.attrs.request_id===e&&!1!==r(o,i,t)&&(l=!0)}),l&&t.dispatch(o),l}},35974:function(e,t,n){n.d(t,{c:()=>l});var r=n(87166);"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);let l=e=>(t,n,l)=>{if(n){var o,i,a;(0,r.S)(e.marks.link,{scrollParent:".editor-scroll",language:"undefined"!=typeof window?null==(a=window)||null==(i=a._preloads)||null==(o=i.publication)?void 0:o.language:null}).spec.run(t,n,l)}return!0}},32526:function(e,t,n){n.d(t,{A_:()=>p,Lz:()=>s,PN:()=>f,Rh:()=>h,cz:()=>v,dG:()=>g,yb:()=>m});var r=n(99851),l=n(43712),o=n(86500),i=n(68349),a=n(39318);class s extends l.Dr{static fromMenuItem(e,t){let{spec:n}=e;return new s(n,t)}constructor(e,t){super(e);const n=this.spec.run;this.spec.run=(e,r,l,i)=>((0,o.u4)(o.qY.EDITOR_MENU_ICON_CLICKED,{button:t||this.spec.label||this.spec.title}),n.call(this,e,r,l,i))}}let c="ProseMirror-prompt",u="".concat(c,"-visible");class d{read(e){return e.value}validate(e){return(e=this.clean(e))||!this.options.required?this.options.validate&&this.options.validate(e):"Required field"}clean(e){return this.options.clean?this.options.clean(e):e}constructor(e){(0,r._)(this,"options",void 0),this.options=e}}class p extends d{render(){let e=document.createElement("input");return e.type="text",e.placeholder=this.options.label,e.value=this.options.value||"",e.className=this.options.className||"",e.autocomplete="off",e}}class f extends p{constructor(e,t,n="en"){const{iString:r}=I18N.i(n);super({label:r("Enter URL..."),className:"url-input",value:t||e&&e.mark.attrs.href||"",required:!0,clean:e=>{let t;return e?(t=e.trim()).startsWith("http")||t.startsWith("mailto")||/^%%.*%%$/.test(t)?t:"http://".concat(t):""},validate:e=>{if(!/^%%.*%%$/.test(e)){if(e.startsWith("".concat((0,a.$_T)(),"/publish/post/"))&&alert(r("This is a link to a post draft. Readers will not be able to access this page.")),e.length>1900)return r("Link is too long");try{let t=new URL(e);if(["http:","https:","mailto:"].includes(t.protocol))return}catch(e){}return e.startsWith("http")?r("Invalid URL"):r("Invalid URL. Try using http://")}}})}}function m(e,t){let{from:n,$from:r,to:l,empty:o}=e.selection;return o?!!t.isInSet(e.storedMarks||r.marks()):e.doc.rangeHasMark(n,l,t)}function h(e){if(g(e))return;let{iString:t}=I18N.i(e.language||"en"),n="".concat(c,"-").concat(e.parentClass),r=e.root||document.body,l=e.scrollParent&&document.querySelector&&document.querySelector(e.scrollParent)||function e(t){return null==t?null:t.scrollHeight>t.clientHeight?t:e(t.parentElement)}(r)||window,o=r.appendChild(document.createElement("div"));o.classList.add(c),e.className&&o.classList.add(e.className),o.id=n,(0,i.iQ)(document.body,u);let a=e=>{o.contains(e.target)||p()},s=()=>{if(e.position)e.position(o,f);else{var t,n;let r=e.parentClass&&(null==(t=(n=document).querySelector)?void 0:t.call(n,".".concat(e.parentClass)));if(r){let t=r.getBoundingClientRect();o.style.top="".concat(t.bottom+(e.offsetTop||0),"px"),o.style.left="".concat(t.left+(e.offsetLeft||0),"px")}else{let t=o.getBoundingClientRect();o.style.top="".concat((window.innerHeight-t.height)/2+(e.offsetTop||0),"px"),o.style.left="".concat((window.innerWidth-t.width)/2+(e.offsetLeft||0),"px")}}},d=t=>{var n;t&&t.preventDefault();let r=function(e,t){let n={},r=0;for(let l in e){let o=e[l],i=t[r++],a=o.read(i),s=o.validate(a);if(s)return function(e,t){let n=e.parentNode;if(!n)return;let r=n.appendChild(document.createElement("div"));r.style.left="".concat(e.offsetLeft+e.offsetWidth+2,"px"),r.style.top="".concat(e.offsetTop-5,"px"),r.className="ProseMirror-invalid",r.textContent=t,setTimeout(()=>n.removeChild(r),1500)}(i,s),null;n[l]=o.clean(a)}return n}(null!=(n=e.fields)?n:{},m);r&&p(r)},p=t=>{(0,i.vy)(document.body,u),window.removeEventListener("mousedown",a),window.removeEventListener("resize",s,!1),l.removeEventListener("scroll",s,!1),o.parentNode&&o.parentNode.removeChild(o),t?(e.onSubmit&&e.onSubmit(t),e.callback&&e.callback(t)):e.onCancel&&e.onCancel(),e.onClose&&e.onClose()};setTimeout(()=>window.addEventListener("mousedown",a),50),window.addEventListener("resize",s,!1),l.addEventListener("scroll",s,!1);let f=o.appendChild(document.createElement("span"));f.className="head";let m=[],h=0;for(let t in e.fields){h++;let n=e.fields[t].render();n.tabIndex=h,m.push(n)}let v=o.appendChild(document.createElement("form"));if(e.title&&(v.appendChild(document.createElement("h5")).textContent=e.title),m.forEach(e=>{v.appendChild(document.createElement("div")).appendChild(e)}),!e.no_buttons){let n=document.createElement("button");n.type="submit",n.className="".concat(c,"-submit"),n.textContent=e.submitText||"OK",n.addEventListener("click",d);let r=document.createElement("button");r.type="button",r.className="".concat(c,"-cancel"),r.textContent=t("Cancel"),r.addEventListener("click",()=>p());let l=v.appendChild(document.createElement("div"));l.className="".concat(c,"-buttons"),l.appendChild(n),l.appendChild(document.createTextNode(" ")),l.appendChild(r)}if(e.footer&&v.appendChild(e.footer),e.openseaEmbedFooter&&v.appendChild(e.openseaEmbedFooter),s(),v.addEventListener("submit",d),e.onInput&&v.addEventListener("input",t=>{var n;null==(n=e.onInput)||n.call(e,t,o)}),v.addEventListener("keydown",e=>{if(27==e.keyCode)e.preventDefault(),p();else if(13!=e.keyCode||e.ctrlKey||e.metaKey||e.shiftKey){if(9==e.keyCode&&(window.setTimeout(()=>{o.contains(document.activeElement)||p()},500),m.length>1)){for(let t=0;t<m.length;t++)if(document.activeElement===m[t]){0===t&&e.shiftKey?(e.preventDefault(),m[m.length-1].focus()):t!==m.length-1||e.shiftKey||(e.preventDefault(),m[0].focus());break}}}else e.preventDefault(),d()}),v.elements.length>0){let e=v.elements[0];for(let t of Array.from(v.elements))if(!t.value&&["INPUT","TEXTAREA"].includes(t.nodeName)){e=t;break}e.focus()}}function g(e){let t="".concat(c,"-").concat(e.parentClass),n=document.getElementById(t);if(n){let e;if(n.querySelector&&(e=n.querySelector(".".concat(c,"-cancel"))),e)e.click();else{var r;null==(r=n.parentNode)||r.removeChild(n),(0,i.vy)(document.body,u)}return!0}}function v(e,t){let n=e.selection.$from;for(let e=n.depth;e>=0;e--){let r=n.index(e);if(n.node(e).canReplaceWith(r,r,t))return!0}return!1}},56909:function(e,t,n){n.d(t,{o:()=>r}),n(10201),n(17402),n(38692);let r=()=>{if(window)return window.LatexModalEvent||(window.LatexModalEvent=new EventTarget),window.LatexModalEvent}},84810:function(e,t,n){n.d(t,{L:()=>a});var r=n(69277),l=n(70408),o=n(17402),i=n(73484);let a=()=>{let{initialTab:e,isDrawerOpen:t,setInitialTab:n,setIsDrawerOpen:a,setPreventChange:s}=(0,i.gJ)(),c=(0,o.useCallback)(e=>{a((0,l._)((0,r._)({},e),{drawerId:"podcast"}))},[a]);return{initialTab:e,isPodcastDrawerOpen:t("podcast"),setInitialTab:n,setIsPodcastDrawerOpen:c,setPreventChange:e=>s({preventChange:e,preventChangeMessage:"Please wait until the upload is finished before closing the drawer"})}}},9129:function(e,t,n){n.d(t,{e4:()=>r}),n(68349);let r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAY4AAAB0BAMAAABgVMiEAAAAMFBMVEX////7+/vt7e3o6Ojm5ubn5+fu7u709PTs7Oz39/f19fX29vby8vLx8fHz8/Pw8PCxY+A8AAAAoklEQVR4AWJgVHYZ+sBIgEE0vXzog7JAhrZZq4Y+WJnB4A5o5w5oAAYBGAi6mcKpQgIaClhCBklz7+AM/Gjo5+Dg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODgeO7g4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4OD4Zse3dmVXfIST0/B1vh0UtMKbNF7rAAAAAElFTkSuQmCC"},47885:function(e,t,n){n.d(t,{Y:()=>a});var r=n(10201),l=n(76977),o=n(63136),i=n(82776);let a=e=>{let{duration:t,icon:n,position:a="bottom-left",previewDuration:s}=e;return(0,r.FD)(l.Ye,{alignItems:"center",bg:"glass-inverted-medium",gap:6,paddingX:8,paddingY:2,position:"absolute",radius:"sm",style:"bottom-left"===a?{left:8,bottom:8}:{right:8,bottom:8},children:[n,(0,r.Y)(o.EY.Meta,{color:"white",lineHeight:20,children:s?"".concat((0,i.secondsToHHMMSS)(s)," / ").concat((0,i.secondsToHHMMSS)(null!=t?t:0)):(0,i.secondsToHHMMSS)(null!=t?t:0)})]})}},82100:function(e,t,n){n.d(t,{Q:()=>s});var r=n(69277),l=n(70408),o=n(32641),i=n(10201),a=n(74715);function s(e){var{isDragging:t,dragProps:n,children:s}=e,c=(0,o._)(e,["isDragging","dragProps","children"]);return(0,i.Y)(a.Z,(0,l._)((0,r._)({outline:"none",border:"detail",borderStyle:t?"solid":"dashed",bg:t?"primary-hover":"primary",animate:!0,pressable:"lg"},n,c),{children:s}))}},8037:function(e,t,n){let r;n.d(t,{Rq:()=>o,T_:()=>c,f9:()=>a,iW:()=>u,mw:()=>s,qy:()=>i});var l=n(82776);n.e("7578").then(n.t.bind(n,86049,19)).then(e=>{r=e.default});let o={"application/x-cbr":[[82,97,114,33,26,7,0],[82,97,114,33,26,7,1,0],[127,69,76,70]],"application/x-cbz":[[80,75,3,4],[80,75,5,6],[80,75,7,8]]},i={"application/vnd.amazon.kfx":[[75,70,88,32]],"application/vnd.amazon.kpf":[[80,75,3,4]],"application/epub+zip":[[80,75,3,4]],"application/x-mobipocket-ebook":[[77,79,66,73]]},a={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[[80,75,3,4],[80,75,5,6],[80,75,7,8]]},s={"application/pdf":[[37,80,68,70]]};function c(e){let{mimeTypesToSignature:t,substackType:n,actionButtonAttr:r}=e;return[{tag:"div.file-embed-wrapper",getAttrs:e=>{let o={};try{var i,a,s;let[c,u,d]=e.children[0].children;if(!c)return!1;let[p,f]=c.children;if(!f||!p)return!1;let[m,h]=f.children;if(!h)return!1;o.title=null==m?void 0:m.textContent;let[g,v]=(null==(i=h.textContent)?void 0:i.split("∙"))||[];if(!g||!v)return!1;o.filesize=(0,l.formattedBytesToNumber)(g);let y=null==(s=v.split("File"))||null==(a=s[0])?void 0:a.trim().toLowerCase();if(!y)return!1;if(t[y]||n===y)o.filetype=y;else{if("file"!==n)return!1;o.filetype=y}return(null==p?void 0:p.classList.contains("file-embed-thumbnail-default"))||(o.thumbnail=p.getAttribute("src")||""),o.description=null==u?void 0:u.innerText,o[r]=null==d?void 0:d.getAttribute("href"),o}catch(e){return!1}}}]}function u(e){var t;let{attrs:n}=e;return"".concat((0,l.numberToHumanFileSize)(null!=(t=Number(n.filesize))?t:void 0)," ∙ ").concat(function(e){var t,n,l,o;let{filetype:i}=e;return r&&i?["application/vnd.amazon.kfx","application/vnd.amazon.kpf","application/vnd.amazon.ebook"].includes(i)?"Kindle":null!=(o=null==(n=r.extension(i)||(null==(l=i.split("/").pop())?void 0:l.split("-").pop()))||null==(t=n.toUpperCase)?void 0:t.call(n))?o:"":""}({filetype:n.filetype})," file")}},86508:function(e,t,n){n.r(t),n.d(t,{EMPTY_DOC:()=>tg,HEADER_IMAGE_ATTRS_FROM_NODE_TYPE:()=>tv,addIdsToHeaders:()=>tW,checkForUnpublishableComments:()=>t4,checkForUnsafeLinks:()=>t9,createStringDoc:()=>nr,customMediaNodes:()=>tb,extractTags:()=>tJ,fromHtml:()=>tV,getCoverImage:()=>tQ,getCoverImages:()=>t7,getDefaultPodcastDescriptionWithoutFeedCTAs:()=>nn,getDescription:()=>tK,getDimensionsFromImageUrl:()=>th,getFirstImageFromBody:()=>t0,getHeaderImageFromBody:()=>t1,getImageUrlsFromPostBody:()=>t2,getImagesFromBody:()=>t$,getLinks:()=>t6,getPreviewImageUrl:()=>t8,hasExplicitPaywall:()=>nl,migrateMarkdown:()=>tG,migratePost:()=>tX,migrateProsemirrorToTiptap:()=>tI,migratePublication:()=>tZ,migrateTiptapToProsemirror:()=>tB,nodeToHtml:()=>tP,normalizeDbPodcastDescriptionToHtmlString:()=>nt,purgeUnsafeLinks:()=>t5,schema:()=>t_,schemaStatic:()=>tE,serializeDoc:()=>tF,serializedToPodcastDescription:()=>tj,setBelowTheFoldAttribute:()=>ne,setButtonActions:()=>t3,tipTapNodes:()=>tN,tipTapSchema:()=>tO,toHtml:()=>tq,toText:()=>tH,trackedCustomNodes:()=>tw,unserializeDoc:()=>tU,unserializeDocAsync:()=>tY,unserializeDocToJSON:()=>tR,unserializeJson:()=>tz});var r=n(69277),l=n(70408),o=n(88285),i=n(76229),a=n(93993),s=n(16571),c=n(55895),u=n(55679),d=n(31707),p=n(16233),f=n(96436),m=n(96282),h=n(58521),g=n(18708),v=n(60526),y=n(34688),b=n(61292),k=n(6142),w=n(35933),x=n(41002),_=n(39001),E=n(90846),A=n(579),C=n(31583),S=n(83673),T=n.n(S),D=n(69843),N=n.n(D),O=n(63375),M=n.n(O),L=n(77003),I=n(98111),B=n(56458),z=n(58278),R=n(463),U=n(39318),Y=n(82776),F=n(38474),P=n(79589),W=n(26082),q=n(55277),H=n(58588),j=n(26116),J=n(55029),V=n(39729),G=n(82086),X=n(37855),Z=n(32422),K=n(82311),Q=n(34202),$=n(83485),ee=n(30909),et=n(42985),en=n(79431),er=n(45595),el=n(60282),eo=n(70679),ei=n(21577),ea=n(85052),es=n(26746),ec=n(97966),eu=n(70084),ed=n(66151),ep=n(32365),ef=n(33967),em=n(92678),eh=n(66347),eg=n(64287),ev=n(89909),ey=n(43146),eb=n(79493),ek=n(28072),ew=n(5113),ex=n(96208),e_=n(93692),eE=n(56456),eA=n(95663),eC=n(28177),eS=n(38435),eT=n(36986),eD=n(67902),eN=n(19015),eO=n(31933),eM=n(19062),eL=n(37859),eI=n(83733),eB=n(36504),ez=n(31611),eR=n(8540),eU=n(17768),eY=n(53680),eF=n(82979),eP=n(78598),eW=n(58097),eq=n(6905),eH=n(63998),ej=n(30131),eJ=n(69866),eV=n(54958),eG=n(41298),eX=n(76527),eZ=n(41758),eK=n(14489),eQ=n(88457),e$=n(88213),e0=n(96384),e1=n(48818),e2=n(40282),e7=n(75594),e8=n(66613),e3=n(52910),e6=n(84262),e4=n(25187),e9=n(51600),e5=n(90565),te=n(54544),tt=n(47727),tn=n(14304),tr=n(23491),tl=n(13625),to=n(60597),ti=n(33333),ta=n(90032),ts=n(79207),tc=n(68530),tu=n(47579),td=n(39248),tp=n(72385),tf=n(54749),tm=n(60147);let th=e=>{var t,n,r,l;let[o,i]=((null==(l=e.split("_"))||null==(r=l[1])||null==(n=r.split("."))||null==(t=n[0])?void 0:t.split("x"))||[0,0]).map(Number);return{width:o||0,height:i||0}},tg={type:"doc",content:[{type:"paragraph"}]},tv={captionedImage:e=>{var t,n,r,l;let o=null==(t=e.content)?void 0:t.find(e=>{var t,n;return"image2"===e.type&&(null==(t=e.attrs)?void 0:t.width)>=300&&(null==e||null==(n=e.attrs)?void 0:n.height)>=300});if(!o)return{url:null,caption:void 0,alt:void 0};let i=null==e||null==(n=e.content)?void 0:n.find(e=>"caption"===e.type);return{url:null==o||null==(r=o.attrs)?void 0:r.src,caption:i,alt:null==o||null==(l=o.attrs)?void 0:l.alt}},image2:e=>{var t,n,r,l;return"number"!=typeof(null==(t=e.attrs)?void 0:t.width)&&"number"!=typeof(null==(n=e.attrs)?void 0:n.height)||e.attrs.width>=300&&e.attrs.height>=300?{url:null==e||null==(r=e.attrs)?void 0:r.src,alt:null==e||null==(l=e.attrs)?void 0:l.alt}:{url:null,caption:void 0,alt:void 0}},image3:e=>{var t,n,r,l,o;let i=th(null==(t=e.attrs)?void 0:t.src);return"number"!=typeof(null==(n=e.attrs)?void 0:n.width)&&"number"!=typeof(null==(r=e.attrs)?void 0:r.height)||e.attrs.width>=300&&e.attrs.height>=300||i.width>=300&&i.height>=300?{url:null==(l=e.attrs)?void 0:l.src,caption:e.content,alt:null==(o=e.attrs)?void 0:o.alt}:{url:null,caption:void 0,alt:void 0}}},ty={image:e=>{var t;return t8(null==(t=e.attrs)?void 0:t.src)},image2:e=>{var t,n,r;return"number"!=typeof(null==(t=e.attrs)?void 0:t.width)&&"number"!=typeof(null==(n=e.attrs)?void 0:n.height)||e.attrs.width>=300&&e.attrs.height>=300?t8(null==(r=e.attrs)?void 0:r.src):null},image3:e=>{var t,n,r,l;let o=th(null==(t=e.attrs)?void 0:t.src);return"number"!=typeof(null==(n=e.attrs)?void 0:n.width)&&"number"!=typeof(null==(r=e.attrs)?void 0:r.height)||e.attrs.width>=300&&e.attrs.height>=300||o.width>=300&&o.height>=300?t8(null==(l=e.attrs)?void 0:l.src):null},imageGallery:e=>{var t,n,r;return t8(null==(r=e.attrs)||null==(n=r.gallery.images)||null==(t=n[0])?void 0:t.src)},spotify:e=>{var t;return t8(null==(t=e.attrs)?void 0:t.image)},spotify2:e=>{var t;return t8(null==(t=e.attrs)?void 0:t.image)},opensea:e=>{var t;return t8(null==(t=e.attrs)?void 0:t.image)},twitter2:e=>{var t,n;if(null==(t=e.attrs)?void 0:t.photos){for(let t of e.attrs.photos)if(t.img_url)return t8(t.img_url)}return(null==(n=e.attrs)?void 0:n.expanded_url)&&e.attrs.expanded_url.image?e.attrs.expanded_url.image.url?t8(e.attrs.expanded_url.image.url):t8(e.attrs.expanded_url.image):null},vimeo:e=>{var t;return td.VG(null==(t=e.attrs)?void 0:t.videoId,{playButton:!1})},youtube:e=>{var t;return tm.VG(null==(t=e.attrs)?void 0:t.videoId,{playButton:!1})},youtube2:e=>{var t;return tm.VG(null==(t=e.attrs)?void 0:t.videoId,{playButton:!1})},kindle:e=>{var t;return(0,U.dJ9)(null==(t=e.attrs)?void 0:t.imageUrl)},applePodcast:e=>{var t;return(0,U.dJ9)(null==(t=e.attrs)?void 0:t.imageUrl)},tiktok:e=>{var t;return(0,U.dJ9)(null==(t=e.attrs)?void 0:t.thumbnail_url)},prediction_market:e=>{var t;return(0,U.dJ9)(null==(t=e.attrs)?void 0:t.thumbnail_url)},manifold:e=>{var t;return(0,U.dJ9)(null==(t=e.attrs)?void 0:t.thumbnail_url)},lichess:e=>{var t;return(0,U.dJ9)(null==(t=e.attrs)?void 0:t.thumbnail_url)},datawrapper:e=>{var t;return(0,U.dJ9)(null==(t=e.attrs)?void 0:t.thumbnail_url)},pinterest:e=>{var t;return t8(null==(t=e.attrs)?void 0:t.image)}},tb={augmentation_placeholder:H.c,youtube2:tm.c,youtube:tf.c,vimeo:td.c,install_substack_app:eY.c,preview_in_substack_app:eQ.c,opensea:ej.c,twitter2:tl.c,twitter:tr.c,communityChat:en.c,communityPost:er.c,comment:et.c,spotify2:e6.c,spotify:e3.c,soundcloud:e7.c,instagram:eU.c,image2:ez.c,image:eI.c,button:G.c,comic:ee.A.nodeSpec,file:ee.A.nodeSpec,pdf:eV.A.nodeSpec,xlsx:tp.A.nodeSpec,ebook:es.A.nodeSpec,referral_link:e1.c,bandcamp:j.c,kindle:eF.c,gitgist:eL.c,embeddedPost:ec.c,embeddedPublication:eu.c,applePodcast:F.c,audio:W.c,video:tu.c,audioUrl:q.c,tiktok:tn.c,bluesky:V.c,poll:eX.c,sponsorshipCampaign:e8.c,imageGallery:eB.c,image3:eR.c,cashtag:$.c,substack_mentions:eH.c,prediction_market:eZ.c,manifold:eZ.c,lichess:eW.c,datawrapper:eo.c,digestPostEmbed:ei.c,assetError:P.c,directMessage:ea.c,recipe:e0.c,pinterest:eG.c},tk=(0,l._)((0,r._)({},tb),{blockquote:J.c,calloutBlock:X.c,fragmentNode:eM.c,captionedImage:Q.c,caption:Z.c,ctaCaption:el.c,footnote:eD.c,footnoteAnchor:eN.c,latex_block:eP.c,paywall:eJ.c,preformatted_text_block:eK.c,pullquote:e$.c,subscribeWidget:e9.c,captionedShareButton:(0,K.c)({url:I.T.SHARE_URL}),captionedWriterReferralButton:(0,K.c)({hasDynamicSubstitutions:!1}),templateComment:tt.c,meeting:eq.c,referralTier:e2.c,fpRecircBlock:eO.c}),tw=(0,l._)((0,r._)({},tb),{subscribeWidget:e9.c,paywall:eJ.c,templateComment:tt.c}),tx={strikethrough:e4.o,superscript:te.L,subscript:e5.i},t_=new A.Sj({nodes:tM(),marks:tL()}),tE=new A.Sj({nodes:tM({isStatic:!0}),marks:tL({isStatic:!0})}),tA=Object.keys(tk).filter(e=>!["blockquote","pullquote","calloutBlock","fpRecircBlock"].includes(e)).map(e=>{let t=(0,ti.m0)(e,tk[e]),n=(0,r._)({},tk[e],t);return"youtube2"===e?n.addNodeView=()=>e=>{let{node:t}=e;return new tm.fe(t)}:"tiktok"===e?n.addNodeView=()=>e=>{let{node:t}=e;return new tn.e1(t)}:"lichess"===e?n.addNodeView=()=>e=>{let{node:t}=e;return new eW.Hk(t)}:"datawrapper"===e?n.addNodeView=()=>e=>{let{node:t}=e;return new eo.nV(t)}:"prediction_market"===e||"manifold"===e?n.addNodeView=()=>e=>{let{node:t}=e;return new eZ.hG(t)}:"paywall"===e?n.addNodeView=()=>e=>new eJ.U:"latex_block"===e?n.addNodeView=()=>e=>{let{node:t}=e;return new eP.uP(t)}:"comic"===e?n.addNodeView=()=>e=>{let{node:t,editor:n,getPos:r}=e;return ee.A.getNodeView({node:t,editor:n,getPos:r})}:"pdf"===e?n.addNodeView=()=>e=>{let{node:t,editor:n,getPos:r}=e;return eV.A.getNodeView({node:t,editor:n,getPos:r})}:"xlsx"===e?n.addNodeView=()=>e=>{let{node:t,editor:n,getPos:r}=e;return tp.A.getNodeView({node:t,editor:n,getPos:r})}:"ebook"===e?n.addNodeView=()=>e=>{let{node:t,editor:n,getPos:r}=e;return es.A.getNodeView({node:t,editor:n,getPos:r})}:"augmentation_placeholder"===e&&(n.addNodeView=()=>(0,C.gu)(L.i)),o.bP.create(n)}),tC=i.Cv.extend({addCommands(){return{toggleBlockquote:()=>e=>{let{state:t,commands:n}=e;return!(!(0,o.rU)(t,"paragraph")||(0,o.rU)(t,"pullquote")||(0,o.rU)(t,"calloutBlock"))&&n.toggleWrap(this.name)}}},parseHTML:()=>J.c.parseDOM}),tS=i.Cv.extend({name:"calloutBlock",addCommands(){return{toggleCalloutBlock:()=>e=>{let{state:t,commands:n}=e;if((0,o.rU)(t,"calloutBlock"))return n.lift("calloutBlock");if((0,o.rU)(t,"paragraph")||(0,o.rU)(t,"button"))return!((0,o.rU)(t,"pullquote")||(0,o.rU)(t,"blockquote"))&&n.toggleWrap(this.name);let r=[t.schema.nodes.paragraph,t.schema.nodes.button].filter(e=>!!e),l=!0;return t.doc.nodesBetween(t.selection.from,t.selection.to,(e,n,o,i)=>{if(o===t.doc&&(e.type===t.schema.nodes.blockquote||e.type===t.schema.nodes.pullquote||!r.includes(e.type)))return l=!1,!1}),!(!l||(0,o.rU)(t,"pullquote")||(0,o.rU)(t,"blockquote"))&&n.toggleWrap(this.name)}}},parseHTML:()=>[{tag:"div[data-callout]",priority:100},{tag:"div.callout-block",priority:99}],renderHTML:()=>["div",{class:"callout-block","data-callout":"true"},0],addInputRules:()=>[]}),tT=h.d.extend({addCommands:()=>({insertHorizontalRule:()=>e=>{let{state:t,dispatch:n}=e;return n&&t.schema.nodes.horizontalRule&&n((0,ti.DL)(t,t.schema.nodes.horizontalRule.create())),!0},setHorizontalRule:()=>e=>{let{state:t,dispatch:n}=e;if(n){if(!t.schema.nodes.horizontalRule)return console.error("horizontalRule is missing"),!1;n((0,ti.DL)(t,t.schema.nodes.horizontalRule.create()))}return!0}})}),tD=u.NG.extend({marks:"_"}),tN=[tC,a.yN,s.Rg,ep.$,tS,c.Cy,tD,em.q,d.y,eg.t,p.B,f.D,m.B,tT,ed.K,eT.T,ey.W,ek.N,e_.P,eC.S,eE.c,ex.k,ev.H,g.J2,eb.u,v.c,y._J,b.f,ew.p,e$.k,k.n,w.E,x.Z,_.E,ef.A,eS.S,eh.I,ea.eW,eO.ik,...tA],tO=(0,o._w)(tN);function tM(){let{isStatic:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=E.wQ.spec.nodes;for(let n of Object.keys(tk)){let r=Object.assign({},tk[n]);e&&r.toDOMStatic&&(r.toDOM=r.toDOMStatic),delete r.toDOMStatic,t=t.get(n)?t.update(n,r):t.addToEnd(n,r)}return t}function tL(){let{isStatic:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=E.wQ.spec.marks;for(let n of Object.keys(tx)){let r=Object.assign({},tx[n]);e&&r.toDOMStatic&&(r.toDOM=r.toDOMStatic),delete r.toDOMStatic,t=t.get(n)?t.update(n,r):t.addToEnd(n,r)}return t}function tI(e){let{postId:t,pubId:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e;return"string"==typeof r&&(r=tz(r,{postId:t,pubId:n})),(0,ti.jE)(r,e=>{let t=ti.rl.find(t=>t[0]===e.type);return t&&(e.type=t[1],e.attrs&&"orderedList"===t[1]&&(e.attrs.start=e.attrs.order)),e.marks&&e.marks.forEach(e=>{var t;let n=ti.EI.find(t=>t[0]===e.type);n&&(e.type=n[1]),"link"===e.type&&(null==(t=e.attrs)?void 0:t.href)===!0&&(e.attrs.href=null)}),e}),r}function tB(e){let{postId:t,pubId:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e;return"string"==typeof r&&(r=tz(r,{postId:t,pubId:n})),(0,ti.jE)(r,e=>{let t=ti.rl.find(t=>t[1]===e.type);return t&&(e.type=t[0],e.attrs&&"ordered_list"===t[0]&&(e.attrs.order=e.attrs.start)),e.marks&&e.marks.forEach(e=>{let t=ti.EI.find(t=>t[1]===e.type);t&&(e.type=t[0])}),e}),r}function tz(e){let t,{postId:n,pubId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&(e=(e=e.replace("http://substack-post-media","https://substack-post-media")).replace("http://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984","https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984")),e=tG(e))try{t=JSON.parse(e)}catch(t){console.error("unserializeJson for post [".concat(n,"], pubId [").concat(r,"], could not parse serialized:"),e,t)}return null!=t?t:void 0}function tR(e){let{docStr:t,postId:n,pubId:r}=e,l=t5(tz(t,{postId:n,pubId:r})||tg);if(!l)throw Error("could not purgeUnsafeLinks");let o=l;return(o=tI(o,{postId:n,pubId:r}))||tg}function tU(e){let{customSchema:t,useTiptap:n,mutateJson:r,shouldSetBelowTheFoldAttribute:l=!1,shouldThrowOnInvalid:o,postId:i,pubId:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let o=tz(e,{postId:i,pubId:a})||tg;r&&r(o);let s=t5(o);if(!s)throw Error("could not purgeUnsafeLinks");let c=s;return l&&(c=ne(c)),c=n?tI(c,{postId:i,pubId:a}):tB(c,{postId:i,pubId:a}),(t||t_).nodeFromJSON(c)}catch(n){if(console.error("Failed to parse JSON for post [".concat(i,"], serialized:"),e,n),o)throw Error("Failed to parse JSON:  ".concat(n.message));return(t||t_).nodeFromJSON(tg)}}async function tY(e){let{customSchema:t,useTiptap:n,mutateJson:r,shouldSetBelowTheFoldAttribute:l=!1,shouldThrowOnInvalid:o,postId:i,pubId:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let o=tz(e,{postId:i,pubId:a})||tg;r&&await r(o);let s=t5(o);if(!s)throw Error("could not purgeUnsafeLinks");let c=s;return l&&(c=ne(c)),c=n?tI(c,{postId:i,pubId:a}):tB(c,{postId:i,pubId:a}),(t||t_).nodeFromJSON(c)}catch(n){if(console.error("Failed to parse JSON for post [".concat(i,"], serialized:"),e,n),o)throw Error("Failed to parse JSON:  ".concat(n.message));return(t||t_).nodeFromJSON(tg)}}function tF(e){let{runMigrations:t=!1,postId:n,pubId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=e.toJSON();return t&&(l=tB(l=t5(l=function(e){let{postId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="string"==typeof e?tz(e,{postId:t}):e;return(0,ti.jE)(n,e=>{e.text&&(e.text=(0,Y.stripInvalidBytes)(e.text))},{nodeTypes:["text"]}),n}(l)),{postId:n,pubId:r})),JSON.stringify(l)}function tP(e,t){let n=document.createElement("div");return n.appendChild(A.ZF.fromSchema(t?tE:t_).serializeFragment(A.FK.fromArray([e]),{document})),n}function tW(e){Array.from(e.querySelectorAll("h2, h3, h4, h5, h6")).forEach(e=>{if(!e.getAttribute("id")){var t,n;let r=(n=e.textContent||"",(0,z.JG)((0,Y.truncateText)(n,500,{ellipsis:""}),{allowUnicode:!0})),l=document.createElement("div");l.setAttribute("id",r),l.setAttribute("class","anchor-target"),null==(t=e.parentNode)||t.insertBefore(l,e);let o=document.createElement("a");for(o.setAttribute("href","#".concat(r));e.firstChild;)o.appendChild(e.firstChild);e.appendChild(o)}})}function tq(e,t){let{isAmp:n,transform:r,useTipTap:l,pubId:o,postId:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(l){let n=tI(tz(e,{postId:i,pubId:o}),{postId:i,pubId:o});if(!n)throw Error("could not serialize json doc");return(0,tc.i)({doc:n,extensions:(0,eA.w)({isStatic:null!=t&&t}),customDocument:document})}let a=tU(e,{shouldSetBelowTheFoldAttribute:!0,postId:i,pubId:o}),s=A.ZF.fromSchema(t?tE:t_),c=document.createElement("div");try{s.serializeFragment(a.content,{document},c)}catch(e){return console.error("could not serialize fragment, for pubId [".concat(o,"], postId [").concat(i,"]"),e),c.innerHTML}return r&&r(c),n&&Array.from(c.querySelectorAll("img")).forEach(e=>{let t=document.createElement("amp-img");t.setAttribute("layout","intrinsic"),e.getAttributeNames().forEach(n=>{var r;"srcset"!==n&&t.setAttribute(n,null!=(r=e.getAttribute(n))?r:"null")}),e.replaceWith(t)}),c.innerHTML}function tH(e,t){let{postId:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,ti.fE)(tU(e,{postId:n}),t)}function tj(e){let{postId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ti.Lz)(tU(e,{postId:t}))}function tJ(e){let{postId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ti.Te)(tU(e,{postId:t}))}function tV(e){let{stripEmptyParagraphs:t,postId:n,pubId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=A.S4.fromSchema(t_).parse(new DOMParser().parseFromString(e,"text/html"));return(t&&(l=(0,ta.c)(l,e=>!e.type||"paragraph"!==e.type.name||!!(0,ti.fE)(e))),l)?tF(l,{postId:n,pubId:r}):null}function tG(e){return e&&"{"!==e[0]&&"null"!==e?tF(E.ee.parse(e)):e}function tX(e){var t,n;return e.body=null!=(t=tG(e.body))?t:null,e.draft_body=null!=(n=tG(e.draft_body))?n:null,e}function tZ(e){var t,n,r,l,o;return e.subscribe_content=null!=(t=tG(e.subscribe_content))?t:null,e.welcome_email_content=null!=(n=tG(e.welcome_email_content))?n:null,e.tos_content=null!=(r=tG(e.tos_content))?r:null,e.privacy_content=null!=(l=tG(e.privacy_content))?l:null,e.disclosures_content=null!=(o=tG(e.disclosures_content))?o:null,e}function tK(e,t){let{post:n=null,pubId:r,minCharacters:l=6,maxStopAfter:o=null,singleSentence:i=!0,language:a="en",excludeMediaPrefix:s=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{iString:c}=I18N.i(a),u=(null==n?void 0:n.type)==="thread"?145:250;(o||0===o)&&(u=Math.min(o,u));let d=(null==n?void 0:n.type)==="thread",p="";if(t)p+=t;else if(0!==u){var f;let t={paragraph:!0,blockquote:!0,list_item:!0,listItem:!0,heading:!0,code_block:!0,codeBlock:!0,hardbreak:!0,hard_break:!0,hardBreak:!0},o={caption:!0,footnote:!0};(0,ti.jE)("string"==typeof e?tz(e,{postId:null!=(f=null==n?void 0:n.id)?f:null,pubId:r}):e,e=>{if(u&&p.length>=u)return!1;if("paywall"===e.type)return ts.Vw;if(e.type&&o[e.type])return!1;if("text"===e.type){let{text:t}=e;if(t){let e=t.match(/[.?!] /);if(i&&(null==e?void 0:e.index))return p+=t.slice(0,e.index+1),ts.Vw;p+=t}}else if(e.type&&t[e.type]&&p){if(p.length>l)return ts.Vw;" "!==p[p.length-1]&&(p+=" ")}else if("substack_mentions"===e.type){var n,r;p+=null!=(r=null==(n=e.attrs)?void 0:n.name)?r:""}})}if(p=p.replace(/\s+/g," ").trim(),d&&u&&p.length>=u&&(p=(0,Y.truncateText)(p,u)),((null==n?void 0:n.type)==="podcast"||(null==n?void 0:n.type)==="video")&&!s){let e=(0,B.Fk)(n);p="".concat(c((null==n?void 0:n.type)==="video"||(null==n?void 0:n.videoUpload)?"Watch now":"Listen now")," ").concat(e?"(".concat((0,Y.secondsToLargestUnit)(e,{minutesCutoff:10800,language:a}),") "):"","| ").concat(p)}return p}function tQ(e,t){var n;return null!=(n=t7(e,t)[0])?n:null}function t$(e){let{postId:t,pubId:n,width:r,height:l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=tz(e,{postId:t,pubId:n});return o?M()(T()((0,ti.zM)(o,e=>{var t;return!!ty[null!=(t=e.type)?t:""]}).map(e=>{var t,n;let o=null==(t=ty[null!=(n=e.type)?n:""])?void 0:t.call(ty,e);return o?(0,U.dJ9)(o,r,{height:l}):null}))):[]}function t0(e){let{postId:t,pubId:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t$(e,{postId:t,pubId:n});return r.length>0&&!N()(r[0])?r[0]:null}function t1(e){let{body:t}=e,n=tz(t);if(n)return(0,ti.zM)(n,e=>{var t;return!!tv[null!=(t=e.type)?t:""]}).map(e=>{var t,n;return null==(t=tv[null!=(n=e.type)?n:""])?void 0:t.call(tv,e)})[0]}async function t2(e){let{body:t,postId:n}=e,r=tU(t,{postId:n}),l=[];return(0,ti.Rv)(r,e=>{switch(e.type.name){case"image":case"image2":e.attrs.src&&l.push(e.attrs.src);break;case"imageGallery":var t;null==(t=e.attrs.gallery.images)||t.map(e=>{e.src&&l.push(e.src)})}}),l}function t7(e,t){var n;let r=[];"podcast_episode_image_info"in t&&t.podcast_episode_image_info&&!t.podcast_episode_image_info.isDefaultArt&&t.podcast_episode_image_info.url!==t.podcast_art_url&&r.unshift(t.podcast_episode_image_info.url),r.unshift(...t$(e,{postId:t.id}));let l="podcastUpload"in t&&t.podcastUpload||"draftPodcastUpload"in t&&t.draftPodcastUpload||void 0;if((null==l?void 0:l.state)==="transcoded"&&(null!=(n=null==l?void 0:l.thumbnail_id)?n:1)>1){let e=(0,U.H10)(l);e&&r.unshift(e)}let o="videoUpload"in t&&t.videoUpload||"draftVideoUpload"in t&&t.draftVideoUpload||void 0;if((null==o?void 0:o.state)==="transcoded"){let e=(0,U.H10)(o);e&&r.unshift(e)}return r}function t8(e){return"string"!=typeof e?null:(e=e.replace(/\/l_twitter_play_button_rvaygk[^/]+/g,""),(0,U.dJ9)(e,void 0,{height:600}))}function t3(e){(0,ti.jE)(e,e=>{var t;return"button"===e.type&&((null==(t=e.attrs)?void 0:t.url)&&"string"==typeof e.attrs.url&&e.attrs.url.startsWith("%%")&&(e.attrs.action=e.attrs.url.replace(/%%/g,"")),!0)},{nodeTypes:"button"})}function t6(e){let{postId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("string"==typeof n){let e=tz(n,{postId:t});if(!e)return[];n=e}t3(n);let r=[];return(0,ti.jE)(n,e=>{var t,n,l;if("button"===e.type&&(null==(t=e.attrs)?void 0:t.url)&&!e.attrs.action)r.push({text:e.attrs.text,url:e.attrs.url});else if("image2"===e.type&&(null==(n=e.attrs)?void 0:n.href))r.push({text:e.attrs.href,url:e.attrs.href});else if(e.marks){for(let t of e.marks)if("link"===t.type&&(null==(l=t.attrs)?void 0:l.href)){r.push({text:e.text,url:t.attrs.href});break}}}),r}function t4(e){let{postId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return!1;let n=e;if("string"==typeof n){let e=tz(n,{postId:t});if(!e)return!1;n=e}return!!(0,ti.cy)(n,e=>"templateComment"===e.type)}function t9(e){let{postId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return!1;let n=e;if("string"==typeof n){let e=tz(n,{postId:t});if(!e)return!1;n=e}return!!(0,ti.cy)(n,e=>{for(let a of["href","src","url"]){var t,n,r,l,o,i;if((null==e||null==(l=e.attrs)||null==(r=l[a])||null==(n=r.trim)||null==(t=(o=n.call(r)).toLowerCase)?void 0:t.call(o).startsWith("javascript:"))||(null==e||null==(i=e.marks)?void 0:i.find(e=>{var t,n,r,l,o;return null==(l=e.attrs)||null==(r=l[a])||null==(n=r.trim)||null==(t=(o=n.call(r)).toLowerCase)?void 0:t.call(o).startsWith("javascript:")})))return!0}return!1})}function t5(e){let t,{postId:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){let r=tz(e,{postId:n});if(!r)return null;t=r}else t=e;return(0,to.M5)(t)?(0,ta.c)(t,e=>{for(let a of["href","src","url"]){var t,n,r,l,o,i;if((null==e||null==(l=e.attrs)||null==(r=l[a])||null==(n=r.trim)||null==(t=(o=n.call(r)).toLowerCase)?void 0:t.call(o).startsWith("javascript:"))||(null==e||null==(i=e.marks)?void 0:i.find(e=>{var t,n,r,l,o;return null==(l=e.attrs)||null==(r=l[a])||null==(n=r.trim)||null==(t=(o=n.call(r)).toLowerCase)?void 0:t.call(o).startsWith("javascript:")})))return!1}return!0}):(0,ta.c)(t,e=>{for(let a of["href","src","url"]){var t,n,r,l,o,i;if((null==e||null==(l=e.attrs)||null==(r=l[a])||null==(n=r.trim)||null==(t=(o=n.call(r)).toLowerCase)?void 0:t.call(o).startsWith("javascript:"))||(null==e||null==(i=e.marks)?void 0:i.find(e=>{var t,n,r,l,o;return null==(l=e.attrs)||null==(r=l[a])||null==(n=r.trim)||null==(t=(o=n.call(r)).toLowerCase)?void 0:t.call(o).startsWith("javascript:")})))return!1}return!0})}function ne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,{postId:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r="string"==typeof e?tz(e,{postId:n}):e;if(!r)return;let l=!1;return"doc"===r.type&&r.content&&r.content.map((e,n)=>{n>t?(0,ti.jE)(e,e=>{!e.content&&e.attrs&&(e.attrs.belowTheFold=!0)}):l||(0,ti.jE)(e,e=>{!e.content&&(null==e?void 0:e.type)=="image2"&&e.attrs&&(e.attrs.topImage=!0,l=!0)})}),r}function nt(e){let{postId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return JSON.parse(e),tj(e,{postId:t})}catch(t){return e}}function nn(e,t){let{body:n,hasPodcastPreview:r}=t;if(!e||!n)return null;let l=n;return r&&(l=JSON.stringify((0,ti.n)(tz(n,{postId:e.id}),{maxLength:"post_preview_limit"in e&&e.post_preview_limit&&"number"==typeof e.post_preview_limit?e.post_preview_limit:356}))),tj(l,{postId:e.id})}function nr(e){return tF(t_.node("doc",null,e.split("\n").map(e=>e.trim()).filter(e=>e.length>0).map(e=>{let t=[],n=(0,R.P2)(e);if(n.length>0){let r=e;for(;;){let e=n.map(e=>[r.indexOf(e.value),e.value]).sort().find(e=>{let[t]=e;return t>=0});if(!e)break;let[l,o]=e;if(l>0&&t.push(t_.text(r.substring(0,l))),!t_.marks.link){console.error("link is missing from schema");continue}t.push(t_.text(o,[t_.marks.link.create({title:o,href:o,target:"_blank"})])),r=r.substring(l+o.length)}r&&t.push(t_.text(r))}else t.push(t_.text(e));return t_.node("paragraph",null,t)})))}function nl(e){let{postId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return!1;let n=e;if("string"==typeof e){let r=tz(e,{postId:t});if(!r)return!1;n=r}else n=e;return(0,ti.Ll)(n)}Object.entries(tO.nodes).forEach(e=>{let[t,n]=e;void 0!==tk[t]&&(n.spec=(0,r._)({},tk[t],n.spec))})},82061:function(e,t,n){n.d(t,{D:()=>o});var r=n(86500),l=n(16044);function o(e){let{msg:t,node:n,err:o,group:a}=e;(0,r.u4)(r.qY.EDITOR_NODE_RENDER_FAILED,{nodeType:n.type.name,nodeAttrs:n.attrs,errMsg:null==o?void 0:o.message});let s=null!=t?t:"Something went wrong";return"block"===a?function(e){let{msg:t}=e,n=document.createElement("div");n.className=l.A.blockContainer;let r=document.createElement("div");r.textContent=t,r.className=l.A.blockTitle;let o=document.createElement("div");o.textContent="Try refreshing the page or try again later.",o.className=l.A.blockSubTitle;let a=document.createElement("div");return a.className=l.A.blockTitleContainer,a.appendChild(r),a.appendChild(o),n.appendChild(i({size:24})),n.appendChild(a),n}({msg:s}):function(e){let{msg:t}=e,n=document.createElement("span");n.className=l.A.inlineContainer;let r=document.createElement("span");return r.className=l.A.inlineText,r.textContent=t,n.appendChild(i({size:10})),n.appendChild(r),n}({msg:s})}function i(e){let{size:t}=e,n="http://www.w3.org/2000/svg",r=document.createElementNS(n,"svg");r.setAttribute("width","".concat(t)),r.setAttribute("height","".concat(t)),r.setAttribute("viewBox","0 0 24 24"),r.setAttribute("fill","none"),r.setAttribute("stroke","#363737"),r.setAttribute("stroke-width","2"),r.setAttribute("stroke-linecap","round"),r.setAttribute("stroke-linejoin","round");let l=document.createElementNS(n,"circle");l.setAttribute("d","M12 8V12M12 16H12.01M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z"),l.setAttribute("cx","12"),l.setAttribute("cy","12"),l.setAttribute("r","10");let o=document.createElementNS(n,"line");o.setAttribute("x1","12"),o.setAttribute("x2","12"),o.setAttribute("y1","8"),o.setAttribute("y2","12");let i=document.createElementNS(n,"line");return i.setAttribute("x1","12"),i.setAttribute("x2","12.01"),i.setAttribute("y1","16"),i.setAttribute("y2","16"),r.appendChild(l),r.appendChild(o),r.appendChild(i),r}},60597:function(e,t,n){function r(e){let{fragment:t}=e;return"content"in t?t.content:[]}function l(e){let{fragment:t,content:n}=e;t.content=n}function o(e){return"type"in e&&"object"==typeof e.type}function i(e){return"type"in e&&"string"==typeof e.type}n.d(t,{M5:()=>i,p0:()=>r,rQ:()=>o,x6:()=>l})},33333:function(e,t,n){n.d(t,{Ao:()=>U,DL:()=>J,EI:()=>v,JK:()=>B,Ll:()=>G,Lz:()=>T,OB:()=>L,Q7:()=>q,Rv:()=>h.Rv,Te:()=>x,WS:()=>j,Z3:()=>V,cy:()=>w,f$:()=>z,fD:()=>F,fE:()=>D,jE:()=>h.jE,jp:()=>M,m0:()=>O,n:()=>b,rl:()=>g,zM:()=>k,zl:()=>I});var r=n(69277),l=n(70408),o=n(26469);n(83673);var i=n(69843),a=n.n(i),s=n(31521),c=n.n(s),u=n(17460),d=n(28700),p=n(82776),f=n(82061),m=n(90032),h=n(79207);let g=[["list_item","listItem"],["bullet_list","bulletList"],["ordered_list","orderedList"],["hard_break","hardBreak"],["horizontal_rule","horizontalRule"],["code_block","codeBlock"]],v=[["em","italic"],["strong","bold"],["strikethrough","strike"]],y={image2:1,image:0,horizontal_rule:0,audio:0,video:0,youtube:0,youtube2:0,vimeo:0,opensea:0,twitter:0,twitter2:0,spotify:0,spotify2:0,soundcloud:0,bandcamp:0,kindle:0,tiktok:0,prediction_market:0,lichess:0,datawrapper:0,recipe:0,pinterest:0},b=function(e){let{maxLength:t=356,getAfterCutoff:n=!1,withEllipsis:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l="",o=!1,i={},a=G(e),s=!1,c=(0,m.c)(e,e=>{var r;if(o)return n;if("paywall"===e.type)return o=!0,!1;if(a)return!0;let c=null!=(r=e.type)?r:"undefined";if(i[c]=(i[c]||0)+1,e.type&&e.type in y&&i[c]>y[e.type])return o=!0,n;let u=t-l.length;if(u<=0&&!a||!(u>0))return n;if(n){if("text"===e.type&&e.text){if(!(t-(l+=e.text).length<=0))return!1;e.text=e.text.substring(e.text.length+t-l.length-1,e.text.length)}}else if("text"===e.type&&e.text){l+=e.text;let t=e.text;e.text=(0,p.truncateText)(t,u),s=t!==e.text}return!0});if(c&&r&&!s){let e=function(e){let t=[],n=[e];for(;n.length;){var r;let e=n.pop();if(!e)break;if(e.content&&(null==(r=e.content)?void 0:r.length)>0)for(let t=e.content.length-1;t>=0;t--){let r=e.content[t];r&&n.push(r)}else t.push(e)}return t}(c),t=null,n=null;for(let r=e.length-1;r>=0&&(!t||!n);r--){let l=e[r];null===t&&(null==l?void 0:l.type)==="text"&&(t=r),null===n&&(null==l?void 0:l.type)!=="text"&&(null==l?void 0:l.type)!=="paragraph"&&(n=r)}let r=null!==t?e[t]:null,l=r&&null!==n&&null!==t&&n>t;r&&!l&&(r.text=N(r.text))}return c},k=(e,t)=>{let n=[];if(e&&(t(e)&&n.push(e),e.content))for(let r of e.content)n=n.concat(k(r,t));return n},w=(e,t)=>{if(e){if(t(e))return e;if(e.content)for(let n of e.content){let e=w(n,t);if(e)return e}}return null},x=e=>{let t=[];return e.nodesBetween(0,e.content.size,e=>{var n;(null==(n=e.type)?void 0:n.name)==="cashtag"&&t.push(e.attrs.symbol)},0),t},_=new Set(["caption","footnote","captionedImage","image","image2"]),E=new Set(["bullet_list","bulletList","ordered_list","orderedList","blockquote"]),A="x_li_start_placeholder_x",C=(e,t)=>{var n,r,l,o;if((null==(n=e.type)?void 0:n.name)==="list_item"||(null==(r=e.type)?void 0:r.name)==="listItem")return{open:A,close:""};if((null==(l=e.type)?void 0:l.name)==="paragraph"||e.isBlock&&e.textContent.length>0&&!E.has(null==(o=e.type)?void 0:o.name)){let e="<p>";return(t.length>0?t[t.length-1]:null)===A&&(t.pop(),e+="* "),{open:e,close:"</p>"}}return null},S=e=>{var t,n,r;let{node:l,recursiveDepth:o,tokens:i}=e;if(o>100)return console.warn("Reached max recursive depth while converting document to HTML for podcast"),!1;let a=!0;if(_.has(null==(t=l.type)?void 0:t.name))a=!1;else if(l.isText){if(l.text&&l.text.length>0){let e=l.marks.find(e=>"link"===e.type.name&&e.attrs.href&&"string"==typeof e.attrs.href),t=l.marks.find(e=>"em"===e.type.name),n=l.marks.find(e=>"strong"===e.type.name),r=l.text;t&&(r="<em>".concat(r,"</em>")),n&&(r="<strong>".concat(r,"</strong>")),e&&(r='<a target="_blank" href="'.concat((0,u.A)(e.attrs.href),'">').concat(r,"</a>")),i.push(r)}}else if(C(l,[])){let e=C(l,i);e&&i.push(e.open),l.descendants(e=>S({node:e,recursiveDepth:o+1,tokens:i})),e&&i.push(e.close),a=!1}else if((null==(n=l.type)?void 0:n.name)==="cashtag")i.push("".concat(l.attrs.symbol," "));else if((null==(r=l.type)?void 0:r.name)==="substack_mentions"){let e=l.marks.find(e=>"em"===e.type.name),t=l.marks.find(e=>"strong"===e.type.name),n=l.attrs.name;if(e&&(n="<em>".concat(n,"</em>")),t&&(n="<strong>".concat(n,"</strong>")),"user"===l.attrs.type){let e=(0,d.rf)(l.attrs.id,l.attrs.name);i.push('<a target="_blank" href="'.concat(e,'">').concat(n,"</a>"))}else if("pub"===l.attrs.type){let e=l.attrs.url;i.push('<a target="_blank" href="'.concat(e,'">').concat(n,"</a>"))}}return a},T=e=>{let t=[];return e.descendants(e=>S({node:e,recursiveDepth:1,tokens:t})),t.filter(e=>e!==A).join("").trim()},D=function(e){let{withLinks:t=!0,withCaptionsAndFootnotes:n=!1,withQuotes:r=!0,forPodcast:l=!1,truncateAt:o=null,truncateTo:i=o,truncateEllipsis:s="…",truncateExtension:c=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d="",f="",m="",h=!0;return e.nodesBetween(0,e.content.size,e=>{var o,g,v,y,b,k,w;if(!n&&["caption","footnote"].includes(null==(o=e.type)?void 0:o.name)||!r&&((null==(g=e.type)?void 0:g.name)==="pullquote"||(null==(v=e.type)?void 0:v.name)==="blockquote"||(null==(y=e.type)?void 0:y.name)==="calloutBlock"))return!1;if(e.isText){if(e.text&&e.text.length>0){let n;h=!1,!a()(i)&&d.length<i&&d.length+e.text.length>=i&&(n=(0,p.truncateText)(e.text,i-d.length,{ellipsis:s,extension:c}));let r=e.marks.filter(e=>"link"===e.type.name&&e.attrs.href)[0],o=e.marks.filter(e=>"em"===e.type.name)[0],g=e.marks.filter(e=>"strong"===e.type.name)[0],v=e.text;d+=v,o&&l&&(n&&(n="<em>".concat(n,"</em>")),v="<em>".concat(v,"</em>")),g&&l&&(n&&(n="<strong>".concat(n,"</strong>")),v="<strong>".concat(v,"</strong>")),r&&t?l?(n&&(m="".concat(f,'<a target="_blank" href="').concat((0,u.A)(r.attrs.href),'">').concat(n,"</a>")),f+='<a target="_blank" href="'.concat((0,u.A)(r.attrs.href),'">').concat(v,"</a>")):(n&&(m="".concat(f).concat(n," [ ").concat(r.attrs.href," ]")),f+="".concat(v," [ ").concat(r.attrs.href," ]")):(n&&(m=f+n),f+=v)}}else!h&&["hard_break","hardBreak"].includes(null==(b=e.type)?void 0:b.name)?(h=!0,d+="\n",l?f+="<br/>":f+="\n"):!h&&e.isBlock?(h=!0,d+="\n",l?f+="<br/><br/>":f+="\n"):(null==(k=e.type)?void 0:k.name)==="cashtag"?f+="".concat(e.attrs.symbol," "):(null==(w=e.type)?void 0:w.name)==="substack_mentions"&&(f+="".concat(e.attrs.name," "))},0),!a()(o)&&d.length>o&&m&&(f=m),f=f.trim(),l&&(f=f.replace(/\s*(<br\/>)+$/,"").trim()),f},N=e=>"".concat(c()(e,"."),"..."),O=(e,t)=>(0,l._)((0,r._)({name:e},t),{addAttributes:()=>t.attrs||{},parseHTML:()=>t.parseDOM,renderHTML(n){let{node:r}=n;if(!t.toDOM)return console.warn("trying to create TipTapNode, no toDOM found for node",e),["span"];try{return t.toDOM(r)}catch(t){try{return console.error("error in toDOM for node",e,t),(0,f.D)({msg:null,node:r,err:t,group:r.isInline?"inline":"block"})}catch(t){return console.error("error rendering error element for node",e,t),(null==r?void 0:r.isInline)?["span"]:["div"]}}}}),M=(e,t)=>{let n,r,l;if(e.doc.nodesBetween(e.selection.from,e.selection.to,(e,o)=>{if(n||r)return!1;let i=e.marks.find(e=>e.type===t);i&&(n=e,r=i,l={from:o,to:o+e.nodeSize})}),n)return{node:n,mark:r,pos:l}},L=(e,t)=>{let n,r,l;if(e.doc.nodesBetween(e.selection.from,e.selection.to,(o,i)=>{if(n||r||!(i<=e.selection.from)||!(e.selection.to<=i+o.nodeSize))return!1;{let e=o.marks.find(e=>e.type===t);e&&(n=o,r=e,l={from:i,to:i+o.nodeSize})}}),!n){if(e.selection.empty){let a=e.doc.resolve(e.selection.from),s=a.nodeBefore&&a.nodeBefore.marks.find(e=>e.type===t),c=a.nodeAfter&&a.nodeAfter.marks.find(e=>e.type===t);if(s||c){var o,i;n=c?a.nodeAfter:a.nodeBefore,r=c||s,l=c?{from:a.pos,to:a.pos+a.nodeAfter.nodeSize}:{from:a.pos-(null!=(i=null==(o=a.nodeBefore)?void 0:o.nodeSize)?i:0),to:a.pos}}}if(!n)return}return{node:n,mark:r,pos:l}},I=function(e){let{allowedMarks:t=[]}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!!e.selection.empty||B(e,e.selection.from,e.selection.to,{allowedMarks:t})},B=function(e,t,n){let{allowedMarks:r=[]}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=!0,o=!1;return e.doc.nodesBetween(t,n,t=>{if(!l)return!1;t.type!==e.schema.nodes.text?o?l=!1:o=!0:t.marks.find(e=>!r.includes(e.type))&&(l=!1)}),l},z=(e,t)=>{if(e.selection.empty)return!1;let n=Array.isArray(t)?t:[t];if("node"in e.selection){var r;let t=e.selection;return n.includes(null==(r=t.node)?void 0:r.type)}return R(e,e.selection.from,e.selection.to,n)},R=(e,t,n,r)=>{let l=null;return e.doc.nodesBetween(t,n,e=>{if(!(!1!==l&&r.includes(e.type)))return l=!1,!1;l=!0}),l||!1},U=e=>e.selection.empty?null:Y(e,e.selection.from,e.selection.to),Y=(e,t,n)=>{let r=null;return e.doc.nodesBetween(t,n,t=>!r&&(t.type===e.schema.nodes.image2?(r=t.attrs.href,!1):void(t.type===e.schema.nodes.image3&&(r=t.attrs.href)))),r||null},F=(e,t,n)=>{e.selection.empty||P(e,t,e.selection.from,e.selection.to,n)},P=(e,t,n,r,l)=>{e.doc.nodesBetween(n,r,(n,r)=>{(n.type===e.schema.nodes.image2||n.type===e.schema.nodes.image3)&&t.setNodeMarkup(r,n.type,Object.assign({},n.attrs,{href:l}),n.marks)})},W=e=>({top:e.top+window.scrollY,bottom:e.bottom+window.scrollY,left:e.left+window.scrollX,right:e.right+window.scrollX}),q=(e,t,n,r)=>{let l=document.body,o=window.innerWidth<=481,i=H(e,t.from,t.to,t=>[e.state.schema.nodes.image,e.state.schema.nodes.image2].includes(t.type))?-44:8,a=W(e.coordsAtPos(t.from)),s=W(e.coordsAtPos(t.to));n.style.position="fixed";let c=s.bottom+(o?l.scrollTop:0),u=l.clientHeight-n.clientHeight-96-i;a.top<s.top?(r&&(r.style.left="10px"),n.style.right="",n.style.left="".concat(Math.min(a.left,s.left),"px")):l.clientWidth-a.left>n.clientWidth?(r&&(r.style.left="10px"),n.style.right="",n.style.left="".concat(a.left,"px")):(r&&(r.style.left="".concat(a.left-l.clientWidth+n.clientWidth,"px")),n.style.right="10px",n.style.left=""),o||c<u?(r&&(r.style.top="-9px",r.style.bottom="auto",r.style.transform=""),n.style.top="".concat(c+i,"px")):(r&&(r.style.top="auto",r.style.bottom="-9px",r.style.transform="rotate(180deg)"),n.style.top="".concat(u+i,"px"))},H=(e,t,n,r)=>{let l=!1;return e.state.doc.nodesBetween(t,n,e=>{if(l)return!1;l=r(e)}),l},j=(e,t)=>{var n;return t.includes(null==(n=e.doc.resolve(e.selection.from).node(1))?void 0:n.type)},J=(e,t)=>{var n,r,l;let i=e.tr,a=i.selection instanceof o.U3,s=a&&(null==(l=i.selection.$from)||null==(r=l.parent)||null==(n=r.content)?void 0:n.size)===0?e.selection.to-1:e.selection.to;if(Array.isArray(t))for(let e of t.slice().reverse())i.insert(s,e);else i.insert(s,t);return a||i.setSelection(o.nh.near(i.doc.resolve(s))),i},V=(e,t)=>{let n=e.tr;return n.replaceSelectionWith(t),n},G=e=>!!w(e,e=>"paywall"===e.type)},8221:function(e,t,n){function r(e){let{tr:t,schema:n}=e,r=!1,l=1,o=1;return t.doc.descendants((e,i)=>{if(e.type===n.nodes.footnote){if(e.attrs.number!==l){let o=n.nodes.footnote.create({number:l},e.content);t.replaceWith(i,i+e.nodeSize,o),r=!0}l+=1}else if(e.type===n.nodes.footnoteAnchor){if(e.attrs.number!==o){let l=n.nodes.footnoteAnchor.create({number:o});t.replaceWith(i,i+e.nodeSize,l),r=!0}o+=1}}),r}function l(e){let{tr:t,schema:n}=e,r=0;t.doc.nodesBetween(0,t.selection.from,e=>{e.type===n.nodes.footnoteAnchor&&(r+=1)});let l=[];if(t.doc.forEach((e,t)=>{e.type===n.nodes.footnote&&l.push(t)}),r<l.length){let e=l[r];return void 0===e?(console.warn("getFootnotePos: footnote position for anchor index ".concat(r," is undefined.")),null):e}return t.doc.resolve(0).end()}n.d(t,{Di:()=>l,TD:()=>r})}}]);