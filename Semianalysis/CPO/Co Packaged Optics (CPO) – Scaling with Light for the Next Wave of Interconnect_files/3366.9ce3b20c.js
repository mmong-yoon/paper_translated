"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["3366"],{5370:function(e,t,r){r.d(t,{A:()=>o});let o={group:"group-JuxKi2",segment:"segment-XiSgAE",outlined:"outlined-kJWSK2"}},8295:function(e,t,r){r.d(t,{Jj:()=>C,_d:()=>S,aD:()=>A,gQ:()=>f});var o=r(69277),n=r(10201),l=r(17402),i=r(21481),a=r(69141),c=r(77578),s=r(2886),u=r(84605),d=r(86500),p=r(68349),h=r(35369),_=r(76977),g=r(16993),m=r(75303),b=r(24777),v=r(63136),y=r(75990),k=r(3843),Y=r(39318),w=r(96670);function f(e){var t;let r,m,b,v,f,T,{pub:I,item:O,isOpen:x,setOpen:R,themeVariables:M,width:P}=e,{iString:L}=(0,u.GO)(),{type:B,target_user:F,target_user_id:G,target_pledge_note:N,target_subscription_note:K,post:W}=O,U=I.logo_url||I.cover_photo_url||I.author_photo_url||(null==(t=I.author)?void 0:t.photo_url),q=null==W?void 0:W.cover_image,H="post_asset"===B,{assetThemes:z,assetTypes:Q,includePreviewTextToggle:V}=((e,t)=>{var r;let{postCoverImageUrl:o,pubCoverImageUrl:n,pub:l,themeVariables:i}=t,a=[],c=[],s=!1,u=i||l.theme,d=null!=(r=(null==u?void 0:u.web_bg_color)||(null==u?void 0:u.cover_bg_color))?r:"";switch(e){case"post_asset":o&&a.push("image"),((null==u?void 0:u.background_pop_color)||(null==u?void 0:u.background_pop))&&a.push("accent"),a.push("primary"),"#ffffff"!==d.toLowerCase()&&a.push("black&white"),s=!0;break;case"pub_shareable_image":n&&a.push("image"),a.push("primary"),c.push({type:"logo",label:"Logo"}),l.has_posts&&c.push({type:"posts",label:"Top posts"}),l.hero_text&&c.push({type:"description",label:"Description"});break;case"paid_subscription":case"pledged_subscription":((null==u?void 0:u.background_pop_color)||(null==u?void 0:u.background_pop))&&a.push("accent"),a.push("primary")}return{assetThemes:a,assetTypes:c,includePreviewTextToggle:s}})(B,{postCoverImageUrl:q,pubCoverImageUrl:U,pub:I,themeVariables:M}),J=M||I.theme,[j,X]=(0,l.useState)(H?"instagram":"stories"),[Z,$]=(0,l.useState)(z.find(e=>"image"===e)&&U?"image":z.find(e=>"accent"===e)&&((null==J?void 0:J.background_pop_color)||(null==J?void 0:J.background_pop))?"accent":"primary"),[ee,et]=(0,l.useState)("logo");(0,l.useEffect)(()=>{x&&(0,d.u4)(d.qY.SHARE_CENTER_CUSTOMIZE_ASSETS_MODAL_OPENED)},[x]);let[er,eo]=(0,l.useState)(!0),en=()=>{switch(Z){case"image":return(0,o._)({aspectRatio:j,bgImage:!0},Q.length&&{type:ee},V&&er&&{hidePreviewText:!0});case"accent":return(0,o._)({aspectRatio:j,bgColor:(null==J?void 0:J.background_pop_color)||(null==J?void 0:J.background_pop),textColor:null==J?void 0:J.print_on_pop},Q.length&&{type:ee},V&&er&&{hidePreviewText:!0});case"primary":return(0,o._)({aspectRatio:j,bgColor:(null==J?void 0:J.web_bg_color)||(null==J?void 0:J.cover_bg_color),textColor:(null==J?void 0:J.print_on_web_bg_color)||(null==J?void 0:J.cover_print_primary)},Q.length&&{type:ee},V&&er&&{hidePreviewText:!0});default:return(0,o._)({aspectRatio:j,bgColor:"#ffffff",textColor:"#404040"},Q.length&&{type:ee},V&&er&&{hidePreviewText:!0})}},el=(0,p.rr)(),ei=()=>{R(!1)};switch(B){case"arr_10k_milestone":b=k.Fh.ARR10K,m=(0,n.Y)(i.Q,{pub:I,milestone:b,style:{aspectRatio:j}}),v=(0,Y.ed9)(I,b,{aspectRatio:j},"".concat(b," - ").concat("stories"===j?"vertical":j));break;case"arr_1k_milestone":b=k.Fh.ARR1K,m=(0,n.Y)(i.Q,{pub:I,milestone:b,style:{aspectRatio:j}}),v=(0,Y.ed9)(I,b,{aspectRatio:j},"".concat(b," - ").concat("stories"===j?"vertical":j));break;case"list_100_milestone":b=k.ai.List100,m=(0,n.Y)(i.Q,{pub:I,milestone:b,style:{aspectRatio:j}}),v=(0,Y.ed9)(I,b,{aspectRatio:j},"".concat(b," - ").concat("stories"===j?"vertical":j));break;case"list_1k_milestone":b=k.ai.List1K,m=(0,n.Y)(i.Q,{pub:I,milestone:b,style:{aspectRatio:j}}),v=(0,Y.ed9)(I,b,{aspectRatio:j},"".concat(b," - ").concat("stories"===j?"vertical":j));break;case"paid_subscription":m=(0,n.Y)(s.zL,{pub:I,note:K,user:F||{id:G||0},style:en()}),v=(0,Y.pJR)(I,F||{id:G||0},en(),{fileToDownload:"Message - ".concat("stories"===j?"vertical":j)}),T=()=>{(0,d.u4)(d.qY.SUBSCRIPTION_NOTE_MEDIA_ASSETS_IMAGE_DOWNLOADED,{note_from_user_id:(null==F?void 0:F.id)||G,aspectRatio:j,source:"download-button"})};break;case"pledged_subscription":m=(0,n.Y)(s.b7,{pub:I,note:N,user:F||{id:G||0},style:en()}),v=(0,Y.H_d)(I,F||{id:G||0},en(),{fileToDownload:"Message - ".concat("stories"===j?"vertical":j)}),T=()=>{(0,d.u4)(d.qY.PLEDGE_NOTE_MEDIA_ASSETS_IMAGE_DOWNLOADED,{note_from_user_id:(null==F?void 0:F.id)||G,aspectRatio:j,source:"download-button"})};break;case"pub_shareable_image":r=L("Create shareable image"),m=(0,n.Y)(a.i,{pub:I,style:en()}),f="".concat(I.name," - ").concat("stories"===j?"vertical":j),v=(0,Y.gEL)(I,null,en(),{fileToDownload:f}),T=()=>{(0,d.u4)(d.qY.PUBLICATION_MEDIA_ASSETS_IMAGE_DOWNLOADED,{aspectRatio:j,source:"download-button"})};break;case"post_asset":{let e=en(),{text:t,translatedText:o}="image"===Z?{text:"Image".concat(er?" - no preview":""),translatedText:L(er?"Image - no preview":"Image")}:"accent"===Z?{text:"Accent Color".concat(er?" - no preview":""),translatedText:L(er?"Accent Color - no preview":"Accent Color")}:"primary"===Z?{text:"Background Color".concat(er?" - no preview":""),translatedText:L(er?"Background Color - no preview":"Background Color")}:{text:"Black and White".concat(er?" - no preview":""),translatedText:L(er?"Black and White - no preview":"Black and White")};r=L("Create shareable image"),m=W&&(0,n.Y)(y.D,{pub:I,post:W,style:e,translatedText:o,size:420,hoverOverlay:!1}),f="".concat(o," - ").concat("stories"===j?"vertical":j),v=W&&(0,Y.fsB)(I,W,e,f),T=()=>{(0,d.u4)(d.qY.WRITER_MEDIA_ASSETS_IMAGE_DOWNLOADED,{post_id:null==W?void 0:W.id,type:t,aspectRatio:e.aspectRatio,share_center:!0,inline:!1,source:"download-button"})}}}["arr_10k_milestone","arr_1k_milestone","list_100_milestone","list_1k_milestone"].includes(B)?(r=L("Share milestone"),f="".concat(b," - ").concat("stories"===j?"vertical":j),T=()=>{(0,d.u4)(d.qY.MILESTONE_MEDIA_ASSETS_IMAGE_DOWNLOADED,{milestone:b,aspectRatio:j,source:"download-button"})}):["paid_subscription","pledged_subscription"].includes(B)&&(r=L("Share message"),f="Message - ".concat("stories"===j?"vertical":j));let ea=async()=>{null==T||T();let e=document.createElement("a");e.href=v,e.download=f,e.target="_blank",e.rel="noopener noreferrer",e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)},ec=z.length>1,es=Q.length>1,eu=c.C1.length>1;return(0,n.FD)(g.aF,{isOpen:x,onClose:ei,width:P||640,renderOverReactLaagPortal:!0,fullscreenMobile:!0,children:[(0,n.Y)(g.rQ,{onClose:ei,title:r,showClose:!0,showDivider:!0}),(0,n.Y)(g.cw,{children:(0,n.FD)(_.I1,{gap:20,children:[(0,n.Y)(_.pT,{className:w.A.imageContainer,alignItems:"center",justifyContent:"center",children:m}),(0,n.FD)(S,{children:[ec&&(0,n.Y)(C,{assetThemes:z,assetTheme:Z,setAssetTheme:$,theme:J,pubCoverImageUrl:U}),es&&(0,n.Y)(E,{assetTypes:Q,assetType:ee,setAssetType:et}),eu&&(0,n.Y)(A,{aspectRatio:j,setAspectRatio:X,includeInstagram:H}),V&&(0,n.Y)(D,{hidePreviewText:er,setHidePreviewText:eo})]})]})}),!el&&(0,n.Y)(g.jl,{showDivider:!0,direction:"column",primaryButton:(0,n.Y)(h.$n,{priority:"primary",onClick:ea,children:L("Download image")})})]})}function C(e){let{assetThemes:t,assetTheme:r,setAssetTheme:o,theme:l,pubCoverImageUrl:i}=e;return(0,n.FD)(_.I1,{gap:8,children:[(0,n.Y)(v.EY.B4,{weight:"medium",translated:!0,children:"Background"}),(0,n.Y)(_.Ye,{gap:8,children:t.map(e=>(0,n.Y)(c.Hg,{value:e,isSelected:e===r,onClick:()=>o(e),themeVariables:l,coverImageUrl:i}))})]})}function E(e){let{assetTypes:t,assetType:r,setAssetType:o}=e;return(0,n.FD)(_.I1,{gap:8,children:[(0,n.Y)(v.EY.B4,{weight:"medium",translated:!0,children:"Type"}),(0,n.Y)(_.Ye,{gap:8,children:t.map(e=>{let{type:t,label:l}=e;return(0,n.Y)(c.jK,{label:l,isSelected:t===r,onClick:()=>o(t)})})})]})}function A(e){let{aspectRatio:t,setAspectRatio:r,includeInstagram:o}=e,l=o?c.C1:c.C1.filter(e=>"instagram"!==e);return(0,n.FD)(_.I1,{gap:8,children:[(0,n.Y)(v.EY.B4,{weight:"medium",translated:!0,children:"Aspect Ratio"}),(0,n.Y)(_.Ye,{gap:8,children:l.map(e=>(0,n.Y)(c.cK,{value:e,isSelected:e===t,onClick:()=>r(e)}))})]})}function D(e){let{hidePreviewText:t,setHidePreviewText:r}=e;return(0,n.FD)(_.I1,{gap:8,children:[(0,n.Y)(v.EY.B4,{weight:"medium",translated:!0,children:"Preview Text"}),(0,n.Y)(_.pT,{flex:"grow",alignItems:"center",children:(0,n.Y)(b.d,{checked:!t,onChange:e=>{r(!e),(0,d.u4)(d.qY.SHARE_CENTER_CUSTOMIZE_ASSETS_PREVIEW_TEXT_TOGGLED,{includePreviewText:e})}})})]})}let S=(0,m.I4)({display:"flex",gap:20,overflowX:"auto",flex:"auto",justifyContent:"space-between"})},64127:function(e,t,r){r.d(t,{JZ:()=>f,PJ:()=>w,g:()=>C,gz:()=>A,tH:()=>E,yg:()=>Y});var o=r(10201),n=r(82853),l=r(93164),i=r(27775),a=r(60996),c=r(60745),s=r(49031),u=r(70357),d=r(38685),p=r(84605),h=r(40691),_=r(35369),g=r(88774),m=r(87370),b=r(78526),v=r(2481),y=r(39318),k=r(49807);let Y=e=>{let{variant:t,url:r,onLinkClicked:n}=e,{iString:l}=(0,p.GO)(),i=()=>{window.open((0,k.yRP)("https://www.facebook.com/sharer/sharer.php",{u:r}),"_blank"),null==n||n("facebook")};return"icon"===t?(0,o.Y)(_.K0,{priority:"secondary-outline",onClick:i,children:(0,o.Y)(s.A,{size:20})}):(0,o.Y)(g.Dr,{leading:(0,o.Y)(s.A,{}),onClick:i,children:l("Share to Facebook")})},w=e=>{let{variant:t,url:r,twitterText:n,onLinkClicked:l}=e,{iString:i}=(0,p.GO)(),a=()=>{window.open((0,y.gKg)({url:r,text:n||""}),"_blank"),null==l||l("twitter")};return"icon"===t?(0,o.Y)(_.K0,{priority:"secondary-outline",onClick:a,children:(0,o.Y)(d.A,{size:20})}):(0,o.Y)(g.Dr,{leading:(0,o.Y)(d.A,{}),onClick:a,children:i("Share to X")})},f=e=>{let{variant:t,url:r,twitterText:n,onLinkClicked:l}=e,{iString:i}=(0,p.GO)(),a=()=>{window.open((0,y.man)({text:n?"".concat(n,"\n").concat(r):null!=r?r:""}),"_blank"),null==l||l("bluesky")};return"icon"===t?(0,o.Y)(_.K0,{priority:"secondary-outline",onClick:a,children:(0,o.Y)(c.A,{size:20})}):(0,o.Y)(g.Dr,{leading:(0,o.Y)(c.A,{}),onClick:a,children:i("Share to Bluesky")})},C=e=>{let{variant:t,url:r,onLinkClicked:l}=e,{iString:i}=(0,p.GO)(),a=(0,b.L)(),c=()=>{r&&(a(r),null==l||l("copy"))};return"icon"===t?(0,o.Y)(_.K0,{priority:"secondary-outline",onClick:c,children:(0,o.Y)(n.A,{height:20})}):(0,o.Y)(g.Dr,{leading:(0,o.Y)(n.A,{}),onClick:c,children:i("Copy link")})},E=e=>{let{variant:t,url:r,onLinkClicked:n}=e,{iString:l}=(0,p.GO)(),i=(0,v.NP)(),a=()=>{i.open({restackUrl:r||""}),null==n||n("notes")};return"icon"===t?(0,o.Y)(_.K0,{priority:"secondary-outline",onClick:a,children:(0,o.Y)(u.A,{size:20})}):(0,o.Y)(g.Dr,{leading:(0,o.Y)(u.A,{}),onClick:a,children:l("Share to Notes")})};function A(e){let t=Y(e),r=f(e),n=w(e),c=C(e),s=E(e),u=(e=>{let{onLinkClicked:t,comment:r}=e,{iString:n}=(0,p.GO)(),{openModal:i,closeModal:c}=(0,h.hS)();return r?(0,o.Y)(g.Dr,{leading:(0,o.Y)(l.A,{}),onClick:()=>{null==t||t("embed"),i({children:(0,o.Y)(a.k,{comment:r||void 0,onClose:c}),width:540})},children:n("Embed note")}):null})(e),d=function(e){let{url:t,onLinkClicked:r}=e,{iString:n}=(0,p.GO)(),l=(0,m.$)();return(0,o.Y)(g.Dr,{leading:(0,o.Y)(i.A,{}),onClick:()=>{l.open({linkAttachmentUrl:null!=t?t:void 0,source:"share_post"}),null==r||r("chat")},children:n("Send as message")})}(e);return(0,o.FD)(o.FK,{children:[(0,o.FD)(g.H9,{isFirst:!0,children:[c,d]}),(0,o.FD)(g.H9,{children:[s,t,r,n]}),(0,o.Y)(g.H9,{children:u})]})}},26606:function(e,t,r){r.d(t,{i:()=>n});var o=r(94729);let n=e=>async t=>{let r="before";t({type:"conversation-request_initial",payload:{conversationId:e}});try{let n=await (0,o.x6)("/api/v1/messages/dm/".concat(e));t({type:"conversation-load_more",payload:{edge:r,cursor:null,page:n}})}catch(o){t({type:"conversation-request_error",payload:{conversationId:e,edge:r,cursor:null,error:o}})}}},68391:function(e,t,r){r.d(t,{C4:()=>c,Kl:()=>a});var o=r(10201),n=r(17402),l=r(46271);let i=(0,n.createContext)({registerVideo:()=>void 0,unregisterVideo:()=>void 0,updatePaywallState:()=>void 0}),a=e=>{let{children:t}=e,[r,a]=(0,n.useState)(0),c=(0,n.useRef)([]),s=(0,n.useRef)(new Map),u=(0,l.Qg)().autoPlayVideo;(0,n.useEffect)(()=>{let e=new IntersectionObserver(e=>{e.forEach(e=>{let t=e.target;"true"===t.getAttribute("data-user-changed-playback")||(e.isIntersecting?!s.current.get(t)&&u&&t.play().catch(e=>{console.log("Unable to autoplay prior to user interaction with the dom.",e),t.muted=!0,t.play().catch(e=>{console.error("Unable to autoplay prior to user interaction with the dom when muted.",e)})}):t.pause())})},{threshold:1});return c.current.forEach(t=>{var r;(null==(r=t.current)?void 0:r.player)&&e.observe(t.current.player)}),()=>{c.current.forEach(t=>{var r;(null==(r=t.current)?void 0:r.player)&&e.unobserve(t.current.player)})}},[r]);let d=(0,n.useCallback)(e=>{e&&!c.current.includes(e)&&(c.current.push(e),a(e=>e+1))},[]),p=(0,n.useCallback)(e=>{c.current=c.current.filter(t=>t!==e),a(e=>e+1)},[]),h=(0,n.useCallback)(e=>{var t;let{videoPlayerRef:r,showPaywall:o}=e;(null==(t=r.current)?void 0:t.player)&&s.current.set(r.current.player,o)},[]);return(0,o.Y)(i.Provider,{value:{registerVideo:d,unregisterVideo:p,updatePaywallState:h},children:t})},c=e=>{let{disable:t,showPaywall:r,videoPlayerRef:o}=e,{registerVideo:l,unregisterVideo:a,updatePaywallState:c}=(0,n.useContext)(i);(0,n.useEffect)(()=>{if(o.current&&!t)return l(o),()=>{a(o)}},[t,l,a,o]),(0,n.useEffect)(()=>{c({showPaywall:r,videoPlayerRef:o})},[r,c,o])}}}]);