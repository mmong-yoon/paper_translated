"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["8051"],{99070:function(e,t,a){a.d(t,{A:()=>S});var i=a(99851),s=a(69277),r=a(70408),n=a(10201),o=a(32485),l=a.n(o),d=a(69843),h=a.n(d),p=a(17402),c=a(60235),u=a(77290),y=a(95931),m=a(46129),g=a(73164),v=a(84605),b=a(13505),_=a(86500),T=a(74894),k=a(17186),f=a(68349),P=a(35369),M=a(56458),E=a(39318),D=a(82776),w=a(57324);let Y="AudioPlayer.playbackRate",N={utm_source:w.VU.twitter,utm_medium:w.Jn.social,utm_campaign:w._9.twitterEmbed};class C extends p.Component{shouldComponentUpdate(e){return this.props.currentPlaybackRate!==e.currentPlaybackRate||this.props.setPlaybackRate!==e.setPlaybackRate}render(){let{currentPlaybackRate:e,setPlaybackRate:t}=this.props;return(0,n.FD)("select",{className:"audio-player-playback-rate",dir:"rtl",onInput:e=>t(Number(e.target.value)),children:[(0,n.Y)("option",{value:"1",selected:1===e,children:"1x"}),(0,n.Y)("option",{value:"1.25",selected:1.25===e,children:"1.25x"}),(0,n.Y)("option",{value:"1.5",selected:1.5===e,children:"1.5x"}),(0,n.Y)("option",{value:"1.75",selected:1.75===e,children:"1.75x"}),(0,n.Y)("option",{value:"2",selected:2===e,children:"2x"})]})}}class S extends p.Component{componentDidMount(){var e;null===f.dO||void 0===f.dO||f.dO.on("play",this._onGlobalPlay),document.body&&(document.body.addEventListener("mousemove",this._onMouseMove,!1),document.body.addEventListener("touchmove",this._onTouchMove,{passive:!1})),window.addEventListener("mouseup",this._onDragEnd,!0),window.addEventListener("touchend",this._onDragEnd,!0),window.addEventListener("touchcancel",this._onDragEnd,!0),this.player&&(this.player.volume=1,this.player.playbackRate=this.state.playbackRate,this.player.addEventListener("canplay",this._onCanPlay),this.player.addEventListener("play",this._onPlay),this.player.addEventListener("pause",this._onPause),this.player.addEventListener("ended",this.onEnded),this.player.addEventListener("timeupdate",this._onTimeUpdate),this.player.addEventListener("ratechange",this._onRateChange),this.player.addEventListener("waiting",this._onWaiting),this.player.addEventListener("playing",this._onPlaying),this.player.addEventListener("seeked",this.onSeeked)),this.progressBar.current&&this.progressBar.current.addEventListener("touchstart",this._onTouchStart,{passive:!0}),this.onTimeUpdate();let t=null==(e=this.player)?void 0:e.duration;!this.props.onGetDuration||h()(t)||isNaN(Number(t))||this.props.onGetDuration(t),(0,f.NN)((0,E.dJ9)("/img/audio-player-pause.png",96))}componentWillUnmount(){null===f.dO||void 0===f.dO||f.dO.off("play",this._onGlobalPlay),document.body&&(document.body.removeEventListener("mousemove",this._onMouseMove,!1),document.body.removeEventListener("touchmove",this._onTouchMove,!1)),window.removeEventListener("mouseup",this._onDragEnd,!0),window.removeEventListener("touchend",this._onDragEnd,!0),window.removeEventListener("touchcancel",this._onDragEnd,!0),this.player&&(this.player.removeEventListener("canplay",this._onCanPlay),this.player.removeEventListener("play",this._onPlay),this.player.removeEventListener("pause",this._onPause),this.player.removeEventListener("ended",this.onEnded),this.player.removeEventListener("timeupdate",this._onTimeUpdate),this.player.removeEventListener("ratechange",this._onRateChange),this.player.removeEventListener("waiting",this._onWaiting),this.player.removeEventListener("playing",this._onPlaying)),this.progressBar.current&&this.progressBar.current.removeEventListener("touchstart",this._onTouchStart)}componentDidUpdate(e,t){if(this.state.playing||"number"!=typeof this.state.waiting||"number"==typeof t.waiting||this.track(_.qY.AUDIO_BUFFERING_STARTED),!this.state.playing||t.playing||this.state.waiting||"number"!=typeof t.waiting||this.track(_.qY.AUDIO_BUFFERING_COMPLETED,{buffering_duration:Date.now()-t.waiting}),this.state.playing&&Math.floor(this.state.currentTime)!==Math.floor(t.currentTime)&&Math.floor(this.state.currentTime)%5==0){var a;if(this.trackMedia(_.qY.MEDIA_PLAYBACK_CONTINUED),(null==(a=this.props.metricsPost)?void 0:a.id)&&this.state.duration&&!this.props.feature){let e=Math.min(Math.max(0,this.state.currentTime/this.state.duration),1);(0,b.AG)(this.props.metricsPost.id,"audio",e)}}if(!this.state.playing&&t.playing&&this.player&&this.player.ended&&(this.props.onFinishAudio&&this.props.onFinishAudio(),this.trackMedia(_.qY.MEDIA_PLAYBACK_COMPLETED)),this.props.updateOnEveryFrame&&this.state.playing&&!t.playing){let e=()=>{this.onTimeUpdate(),this.loopId=requestAnimationFrame(e)};this.loopId=requestAnimationFrame(e)}this.props.updateOnEveryFrame&&!this.state.playing&&t.playing&&(h()(this.loopId)||cancelAnimationFrame(this.loopId)),this.progressBar.current&&(this.progressBar.current.removeEventListener("touchstart",this._onTouchStart),this.progressBar.current.addEventListener("touchstart",this._onTouchStart,{passive:!0}))}onCanPlay(){this.props.onGetDuration&&this.player&&this.props.onGetDuration(this.player.duration),this.onTimeUpdate()}onPlay(){null===f.dO||void 0===f.dO||f.dO.emit("play",this),this.setState({playing:!0}),this.trackMedia(_.qY.MEDIA_PLAYBACK_STARTED)}onPause(){var e;this.setState({playing:!1,waiting:!1}),(null==(e=this.player)?void 0:e.ended)||this.trackMedia(_.qY.MEDIA_PLAYBACK_PAUSED)}onTimeUpdate(){if(this.player&&isFinite(this.player.duration)){if(this.player.currentTime>this.player.duration){this.player.currentTime=this.player.duration;return}this.state.duration!==this.player.duration||this.state.currentTime!==this.player.currentTime?(this.setState({duration:this.player.duration||this.props.duration,currentTime:this.player.currentTime,waiting:!1}),this.props.onTimeUpdate&&this.props.onTimeUpdate({duration:Math.max(this.state.duration||0,this.player.duration||this.props.duration||0),currentTime:this.player.currentTime})):this.setState({waiting:!1})}}onRateChange(){this.player&&this.state.playbackRate!==this.player.playbackRate&&this.setState({playbackRate:this.player.playbackRate})}onWaiting(){this.setState({waiting:Date.now()})}onPlaying(){this.setState({playing:!0,waiting:!1})}onMouseDown(e){this.onDragStart(e.clientX)}onMouseMove(e){this.onDragMove(e.clientX)}onTouchStart(e){e.touches&&e.touches[0]&&this.onDragStart(e.touches[0].pageX)}onTouchMove(e){"number"==typeof this.state.dragTime&&e.preventDefault(),e.touches&&e.touches[0]&&this.onDragMove(e.touches[0].pageX)}onDragStart(e){"number"!=typeof this.state.dragTime&&this.setDragTime(e)}onDragMove(e){"number"==typeof this.state.dragTime&&this.setDragTime(e)}onDragEnd(){this.clearDragTime()}onGlobalPlay(e){if(this!==e&&this.player&&!this.player.paused){let t=e.player;t instanceof HTMLVideoElement&&t.muted||(this.track(_.qY.CLICKED_PAUSE_BUTTON,{implicit:!0,feature:this.props.feature}),this.player.pause())}}async togglePlayback(){let{iString:e}=this.context;if(this.player)if(this.player.paused){this.track(_.qY.CLICKED_PLAY_BUTTON,{feature:this.props.feature});try{await this.player.play()}catch(t){if("NotSupportedError"===t.name)alert(e("Failed to play this media: it may not be supported by this browser."));else throw t}}else this.track(_.qY.CLICKED_PAUSE_BUTTON,{feature:this.props.feature}),await this.player.pause()}skipBack(){if(this.player){let e=Math.max(0,this.state.currentTime-15);this.player.currentTime=e}}skipForward(){if(this.player){var e;let t=Math.min(null!=(e=this.state.duration)?e:0,this.state.currentTime+30);this.player.currentTime=t}}setDragTime(e){if(!this.props.src||!this.state.duration||!this.player||!this.progressBar.current||!document.body||!document.body.getBoundingClientRect)return;let t=document.body.getBoundingClientRect(),a=this.progressBar.current.getBoundingClientRect(),i=a.left-t.left,s=a.right,r=(Math.max(i,Math.min(s,e))-i)/(s-i)*this.state.duration;this.isDragTimeCloseToCurrentTime(r)&&(r=this.state.currentTime),this.setState({dragTime:r})}clearDragTime(){if("number"!=typeof this.state.dragTime)return;let e=this.state.dragTime;this.isDragTimeCloseToCurrentTime(e)?this.setState({dragTime:null}):(this.setState({currentTime:e,dragTime:null,lastDragClearedAt:performance.now()}),this.player&&(this.player.currentTime=e))}isDragTimeCloseToCurrentTime(e){let t;return!this.props.preventSnappingToCurrentTime&&"number"==typeof this.state.currentTime&&(t=!h()(this.state.duration)&&this.state.duration<10?0:!h()(this.state.duration)&&this.state.duration<30?3:5,Math.abs(this.state.currentTime-e)<t)}track(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.props.metricsPost;a&&(0,_.u4)(e,Object.assign({post_id:a.id,publication_id:a.publication_id,is_podcast_free_preview:(0,M.XP)(a),current_time:this.state.currentTime?Math.floor(this.state.currentTime):0,duration:this.state.duration?Math.floor(this.state.duration):0,playback_rate:this.state.playbackRate},t))}trackMedia(e){var t,a,i,n,o;let{pub:l,mediaUpload:d,src:h,trackingProps:{feedItemTrackingParameters:p,surface:c,contentType:u,entityKey:y,entityType:m,primaryEntityKey:g,primaryEntityType:v}={}}=this.props;(0,_.u4)(e,(0,r._)((0,s._)({},p),{media_type:"audio",video_upload_id:null!=(a=null==d?void 0:d.id)?a:"unknown",src_video_upload_id:d&&"src_media_upload_id"in d?d.src_media_upload_id:void 0,surface:c,content_type:u,primary_entity_key:String(null!=(i=null!=g?g:y)?i:"unknown"),primary_entity_type:null!=v?v:m,entity_key:String(y),entity_type:m,publication_id:null==l?void 0:l.id,display:"inline",muted:null==(t=this.player)?void 0:t.muted,captions_enabled:null,autoplay:!1,is_preview:!1,current_time:Math.floor(null!=(n=this.state.currentTime)?n:0),duration:Math.floor(null!=(o=this.state.duration)?o:0),src:h}))}render(){let{addToPodcastLink:e,autoPlay:t,isFancy:a,isPaywalled:i,post:s,pub:r,render:o,showCTAs:l,skipPreloading:d,src:h}=this.props,{iString:p}=this.context;if(o){let{dragTime:e,duration:a,currentTime:s,playbackRate:r}=this.state,l="number"==typeof e?e:s;return(0,n.FD)(n.FK,{children:[o({isPaywalled:i,progress:a?("number"==typeof e?e:s)/a:0,currentTime:a?(0,D.secondsToHHMMSS)(l):"--:--",dragTime:"number"==typeof e?(0,D.secondsToHHMMSS)(e):null,duration:a,remainingTime:a?"-".concat((0,D.secondsToHHMMSS)(a-Math.min(l,a))):"--:--",isPlaying:this.state.playing,playbackRate:r,progressBarOnMouseDown:e=>{this.onMouseDown(e)},progressBarRef:this.progressBar,setPlaybackRate:e=>{this.setPlaybackRate(e)},skipBack:()=>{this.skipBack()},skipForward:()=>{this.skipForward()},togglePlayback:()=>{this.togglePlayback()}}),h&&!i&&(0,n.Y)("audio",{ref:this.assignPlayer,src:h,autoPlay:t,preload:d?"none":"auto",children:p("Audio playback is not supported on your browser. Please upgrade.")})]})}return a?this.renderFancy({src:h,autoPlay:t,pub:r,post:s,showCTAs:l}):this.renderOriginal({src:h,autoPlay:t,pub:r,addToPodcastLink:e})}renderFancy(e){var t,a;let{src:i,autoPlay:o,pub:l,post:d,showCTAs:h}=e,{iString:p}=this.context,c=(0,T.M$)(l,d);return(0,n.Y)(n.FK,{children:(0,n.Y)("div",{className:"audio-player-wrapper-fancy",children:(0,n.FD)("div",{className:"audio-player",children:[(0,n.Y)("div",{className:"audio-player-substack-logo audio-player-clickable",onClick:this.openEpisodePage,children:(0,n.Y)(g.A,{color:"#F8F8F8"})}),(0,n.Y)("div",{className:"audio-player-hero-image-container audio-player-clickable",onClick:this.openEpisodePage,children:c&&(0,n.Y)("img",{className:"audio-player-hero-image audio-player-clickable",src:(0,E.dJ9)(c,500,{height:500,crop:"fill"}),onClick:this.openEpisodePage})}),(0,n.Y)("div",{className:"audio-player-title audio-player-clickable",onClick:this.openEpisodePage,children:null!=(t=null==d?void 0:d.title)?t:""}),(0,n.Y)("div",{className:"audio-player-subtitle audio-player-clickable",onClick:this.openEpisodePage,children:null!=(a=null==d?void 0:d.subtitle)?a:""}),i&&(0,n.Y)("audio",{"data-testid":"audio-element",ref:this.assignPlayer,src:i,autoPlay:o,children:p("Audio playback is not supported on your browser. Please upgrade.")}),this.renderProgressFancy(this.props,this.state),this.renderButtonsFancy(this.props,this.state),h&&(0,n.FD)("div",{className:"btn-group",children:[(0,n.Y)(P.$n,{priority:"secondary",newTab:!0,onClick:this.openEpisodePage,children:p("View post")}),(0,n.Y)(P.$n,{priority:"primary",href:l?this.maybeAppendIframeVisitId((0,E.eV6)(l,(0,r._)((0,s._)({},N),{simple:!0,next:(0,E.wu9)(l,d)}))):void 0,newTab:!0,children:(0,D.getSubscribeText)(l)})]})]})})})}renderOriginal(e){let{src:t,autoPlay:a,pub:i,addToPodcastLink:s}=e,{iString:r}=this.context;return(0,n.FD)("div",{className:"audio-player-wrapper",children:[(0,n.FD)("div",{className:"audio-player",children:[t&&(0,n.Y)("audio",{ref:this.assignPlayer,src:t,autoPlay:a,children:r("Audio playback is not supported on your browser. Please upgrade.")}),this.renderButtons(this.props,this.state),this.renderProgress(this.props,this.state)]}),s&&i&&!i.hide_podcast_feed_link&&(0,n.Y)("div",{className:"audio-player-add-to-podcast-link",children:(0,n.Y)("a",{href:s,target:"_blank",rel:"noopener",children:r("Listen in podcast app")})})]})}renderButtonsFancy(e,t){let{playing:a,waiting:i}=t;return(0,n.FD)("div",{className:"audio-player-buttons",children:[(0,n.Y)("button",{className:"audio-player-backward","aria-pressed":"false",onClick:()=>this.skipBack(),children:(0,n.Y)(c.A,{className:"skip-icon"})}),(0,n.Y)("button",{className:l()("audio-player-play",{pause:"playing",waiting:i}),"aria-pressed":"false",onClick:()=>this.togglePlayback(),children:a?(0,n.Y)(y.A,{className:"playback-icon pause",fill:"#1C110B"}):(0,n.Y)(m.A,{className:"playback-icon play",fill:"#1C110B"})}),(0,n.Y)("button",{className:"audio-player-forward","aria-pressed":"false",onClick:()=>this.skipForward(),children:(0,n.Y)(u.A,{className:"skip-icon"})})]})}renderButtons(e,t){let{src:a,href:i,isStatic:s}=e,{playing:r,waiting:o,playbackRate:l}=t;return(0,n.FD)("div",{className:"audio-player-buttons",children:[(0,n.Y)("table",{className:"custom",children:(0,n.FD)("tr",{children:[(0,n.Y)("td",{className:"audio-player-buttons-spacing",children:"\xa0"}),(0,n.Y)("td",{className:"audio-player-backward",children:(0,n.Y)("a",{role:"button",className:"button",tabIndex:0,"aria-pressed":"false",href:i||"javascript:void(0)",onClick:()=>this.skipBack(),children:(0,n.Y)(c.A,{className:"skip-icon",fill:"#3c3c3c",height:30,isStatic:s})})}),(0,n.Y)("td",{className:"audio-player-play ".concat(r?"pause":""," ").concat(o?"waiting":""),children:(0,n.Y)("a",{className:"button",role:"button",tabIndex:0,"aria-pressed":"false",href:i||"javascript:void(0)",onClick:()=>this.togglePlayback(),children:(0,n.Y)("img",{src:(0,E.dJ9)(r?"/img/audio-player-pause.png":"/img/audio-player-play.png",96)})})}),(0,n.Y)("td",{className:"audio-player-forward",children:(0,n.Y)("a",{role:"button",className:"button",tabIndex:0,"aria-pressed":"false",href:i||"javascript:void(0)",onClick:()=>this.skipForward(),children:(0,n.Y)(u.A,{className:"skip-icon",fill:"#3c3c3c",height:30,isStatic:s})})}),(0,n.Y)("td",{className:"audio-player-buttons-spacing",children:"\xa0"})]})}),a&&(0,n.Y)(C,{currentPlaybackRate:l,setPlaybackRate:this.setPlaybackRate})]})}renderProgress(e,t){let{duration:a,currentTime:i,dragTime:s}=t;return(0,n.Y)("div",{className:"audio-player-progress",children:(0,n.Y)("table",{className:"custom",children:(0,n.FD)("tr",{children:[(0,n.Y)("td",{className:"audio-player-progress-past",children:a?(0,D.secondsToHHMMSS)(i):"--:--"}),(0,n.FD)("td",{ref:this.progressBar,className:"audio-player-progress-bar",onMouseDown:e=>this.onMouseDown(e),children:[(0,n.Y)("div",{className:"audio-player-progress-bar-track"}),(0,n.Y)("div",{className:"audio-player-progress-bar-filled",style:"width:".concat(a?100*("number"==typeof s?s:i)/a:0,"%")}),(0,n.Y)("div",{className:"audio-player-progress-bar-current",style:"left:".concat(a?100*i/a:0,"%")}),(0,n.Y)("div",{className:"audio-player-progress-bar-button",style:"left:".concat(a?100*("number"==typeof s?s:i)/a:0,"%")}),"number"==typeof s&&(0,n.Y)("div",{className:"audio-player-progress-bar-popup",style:"left:".concat(a?100*s/a:0,"%"),children:(0,D.secondsToHHMMSS)(s)})]}),(0,n.Y)("td",{className:"audio-player-progress-left",children:a?"-".concat((0,D.secondsToHHMMSS)(a-Math.min(i,a))):"--:--"})]})})})}renderProgressFancy(e,t){let{duration:a,currentTime:i,dragTime:s,lastDragClearedAt:r}=t,o="number"==typeof s,d=!!r&&performance.now()-r<50;return(0,n.FD)(n.FK,{children:[(0,n.Y)("div",{className:"audio-player-progress",children:(0,n.FD)("div",{ref:this.progressBar,className:"audio-player-progress-bar",onMouseDown:e=>this.onMouseDown(e),children:[(0,n.Y)("div",{className:"audio-player-progress-bar-track"}),(0,n.Y)("div",{className:"audio-player-progress-bar-filled",style:{width:"".concat(a?100*(o?s:i)/a:0,"%")}}),(0,n.Y)("div",{className:l()("audio-player-progress-bar-current",{"audio-player-progress-bar-current-placeholder":o,"audio-player-progress-bar-current-disable-animations":d}),style:"left:".concat(a?100*i/a:0,"%")}),o&&(0,n.Y)("div",{className:"audio-player-progress-bar-current audio-player-progress-bar-current-dragging",style:"left:".concat(a?100*s/a:0,"%")}),o&&(0,n.Y)("div",{className:"audio-player-progress-bar-popup",style:"left:".concat(a?100*s/a:0,"%"),children:(0,D.secondsToHHMMSS)(s)})]})}),(0,n.FD)("div",{className:"audio-player-time-wrapper",children:[(0,n.Y)("div",{className:"audio-player-progress-past",children:a?(0,D.secondsToHHMMSS)(i):"--:--"}),(0,n.Y)("div",{className:"audio-player-progress-left",children:a?"-".concat((0,D.secondsToHHMMSS)(a-Math.min(i,a))):"--:--"})]})]})}constructor(e,t){super(e,t),(0,i._)(this,"player",void 0),(0,i._)(this,"progressBar",(0,p.createRef)()),(0,i._)(this,"loopId",void 0),(0,i._)(this,"isShowingCaptionsElsewhere",!1),(0,i._)(this,"_onGlobalPlay",void 0),(0,i._)(this,"_onMouseMove",void 0),(0,i._)(this,"_onTouchStart",void 0),(0,i._)(this,"_onTouchMove",void 0),(0,i._)(this,"_onDragEnd",void 0),(0,i._)(this,"_onCanPlay",void 0),(0,i._)(this,"_onPlay",void 0),(0,i._)(this,"_onPause",void 0),(0,i._)(this,"_onTimeUpdate",void 0),(0,i._)(this,"_onRateChange",void 0),(0,i._)(this,"_onWaiting",void 0),(0,i._)(this,"_onPlaying",void 0),(0,i._)(this,"assignPlayer",e=>{this.player=e}),(0,i._)(this,"onEnded",()=>{this.setState({playing:!1,waiting:!1}),this.trackMedia(_.qY.MEDIA_PLAYBACK_PAUSED)}),(0,i._)(this,"onSeeked",()=>{this.trackMedia(_.qY.MEDIA_SEEKED)}),(0,i._)(this,"setPlaybackRate",e=>{this.state.playbackRate!==e&&(this.player&&(this.player.playbackRate=e),this.setState({playbackRate:e}),(0,k.X3)(Y,e))}),(0,i._)(this,"maybeAppendIframeVisitId",e=>{let t=(0,_.TM)(),a=t?t.id:null;return a&&(e=(0,E.oRR)(e,{src_iid:a})),e}),(0,i._)(this,"openEpisodePage",()=>{if(!this.props.post)return;let e=this.props.post.canonical_url;e=this.maybeAppendIframeVisitId(e),e=(0,E.oRR)(e,N),(0,f.V2)(e,{newTab:!0})}),this._onGlobalPlay=this.onGlobalPlay.bind(this),this._onMouseMove=this.onMouseMove.bind(this),this._onTouchStart=this.onTouchStart.bind(this),this._onTouchMove=this.onTouchMove.bind(this),this._onDragEnd=this.onDragEnd.bind(this),this._onCanPlay=this.onCanPlay.bind(this),this._onPlay=this.onPlay.bind(this),this._onPause=this.onPause.bind(this),this._onTimeUpdate=this.onTimeUpdate.bind(this),this._onRateChange=this.onRateChange.bind(this),this._onWaiting=this.onWaiting.bind(this),this._onPlaying=this.onPlaying.bind(this),this.state={playbackRate:e.playbackRate||(0,k.xm)(Y,1),currentTime:0,waiting:!0,duration:e.duration||void 0,lastDragClearedAt:null}}}(0,i._)(S,"contextType",v.OW)}}]);